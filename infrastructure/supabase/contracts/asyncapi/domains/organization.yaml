components:
  messages:
    OrganizationCreated:
      name: organization.created
      title: Organization Created
      summary: A new organization has been created in the hierarchy
      contentType: application/json
      payload:
        $ref: '#/components/schemas/OrganizationCreatedEvent'

    OrganizationUpdated:
      name: organization.updated
      title: Organization Updated
      summary: Organization information has been updated
      contentType: application/json
      payload:
        $ref: '#/components/schemas/OrganizationUpdatedEvent'

    OrganizationBusinessProfileCreated:
      name: organization.business_profile.created
      title: Organization Business Profile Created
      summary: Business profile created for top-level organization during onboarding
      contentType: application/json
      payload:
        $ref: '#/components/schemas/OrganizationBusinessProfileCreatedEvent'

    OrganizationBusinessProfileUpdated:
      name: organization.business_profile.updated
      title: Organization Business Profile Updated
      summary: Business profile information has been updated
      contentType: application/json
      payload:
        $ref: '#/components/schemas/OrganizationBusinessProfileUpdatedEvent'

    OrganizationDeactivated:
      name: organization.deactivated
      title: Organization Deactivated
      summary: Organization has been deactivated (billing, compliance, operational)
      contentType: application/json
      payload:
        $ref: '#/components/schemas/OrganizationDeactivatedEvent'

    OrganizationReactivated:
      name: organization.reactivated
      title: Organization Reactivated
      summary: Organization has been restored to active status
      contentType: application/json
      payload:
        $ref: '#/components/schemas/OrganizationReactivatedEvent'

    OrganizationActivated:
      name: organization.activated
      title: Organization Activated
      summary: Organization has been activated after successful bootstrap provisioning
      contentType: application/json
      payload:
        $ref: '#/components/schemas/OrganizationActivatedEvent'

    OrganizationDnsRemoved:
      name: organization.dns.removed
      title: Organization DNS Removed
      summary: DNS record removed during cleanup or compensation
      contentType: application/json
      payload:
        $ref: '#/components/schemas/OrganizationDnsRemovedEvent'

    OrganizationDeleted:
      name: organization.deleted
      title: Organization Deleted
      summary: Organization has been logically deleted with cascade handling
      contentType: application/json
      payload:
        $ref: '#/components/schemas/OrganizationDeletedEvent'

    OrganizationDirectCareSettingsUpdated:
      name: organization.direct_care_settings_updated
      title: Organization Direct Care Settings Updated
      summary: Direct care workflow routing settings updated for an organization
      contentType: application/json
      payload:
        $ref: '#/components/schemas/OrganizationDirectCareSettingsUpdatedEvent'

    # Bootstrap Events - Organization creation via platform management
    OrganizationBootstrapInitiated:
      name: organization.bootstrap.initiated
      title: Organization Bootstrap Initiated
      summary: Bootstrap process started for new provider or provider_partner
        organization
      contentType: application/json
      payload:
        $ref: '#/components/schemas/OrganizationBootstrapInitiatedEvent'

    OrganizationBootstrapCompleted:
      name: organization.bootstrap.completed
      title: Organization Bootstrap Completed
      summary: Organization bootstrap process successfully completed
      contentType: application/json
      payload:
        $ref: '#/components/schemas/OrganizationBootstrapCompletedEvent'

    OrganizationBootstrapFailed:
      name: organization.bootstrap.failed
      title: Organization Bootstrap Failed
      summary: Organization bootstrap process failed, triggering compensation
      contentType: application/json
      payload:
        $ref: '#/components/schemas/OrganizationBootstrapFailedEvent'

    OrganizationBootstrapCancelled:
      name: organization.bootstrap.cancelled
      title: Organization Bootstrap Cancelled
      summary: Organization bootstrap process cancelled and cleanup completed
      contentType: application/json
      payload:
        $ref: '#/components/schemas/OrganizationBootstrapCancelledEvent'

    # Subdomain Provisioning Events
    OrganizationSubdomainDnsCreated:
      name: organization.subdomain.dns_created
      title: Organization Subdomain DNS Created
      summary: DNS CNAME record created in Cloudflare for organization subdomain
      contentType: application/json
      payload:
        $ref: '#/components/schemas/OrganizationSubdomainDnsCreatedEvent'

    OrganizationSubdomainVerified:
      name: organization.subdomain.verified
      title: Organization Subdomain Verified
      summary: DNS resolution verified for organization subdomain
      contentType: application/json
      payload:
        $ref: '#/components/schemas/OrganizationSubdomainVerifiedEvent'

    OrganizationSubdomainVerificationFailed:
      name: organization.subdomain.verification_failed
      title: Organization Subdomain Verification Failed
      summary: DNS verification failed for organization subdomain
      contentType: application/json
      payload:
        $ref: '#/components/schemas/OrganizationSubdomainVerificationFailedEvent'

  schemas:
    OrganizationCreatedEvent:
      title: OrganizationCreatedEvent
      type: object
      required:
        - stream_id
        - stream_type
        - event_type
        - event_data
        - event_metadata
      properties:
        stream_id:
          type: string
          format: uuid
          description: Organization UUID
        stream_type:
          type: string
          const: organization
        event_type:
          type: string
          const: organization.created
        event_data:
          $ref: '#/components/schemas/OrganizationCreationData'
        event_metadata:
          $ref: '../components/schemas.yaml#/components/schemas/EventMetadata'

    OrganizationCreationData:
      title: OrganizationCreationData
      type: object
      required:
        - name
        - slug
        - type
        - path
      properties:
        name:
          type: string
          maxLength: 200
          description: Human-readable organization name
          examples:
            - "ACME Healthcare Services"
            - "North Campus"
        display_name:
          type: string
          maxLength: 200
          description: Display name for UI (may differ from name)
        slug:
          type: string
          maxLength: 100
          pattern: '^[a-z0-9-]+$'
          description: URL-friendly identifier
          examples:
            - "acme-healthcare"
            - "north-campus"
        type:
          allOf:
            - $ref: ../components/enums.yaml#/components/schemas/OrganizationType
            - description: >
                Organization type determining access patterns and capabilities:

                - platform_owner: A4C internal organization (impersonation
                capability)

                - provider: Healthcare organizations serving clients (data
                owners)

                - provider_partner: External stakeholders (VARs, families,
                courts - access via grants)
        partner_type:
          allOf:
            - $ref: ../components/enums.yaml#/components/schemas/PartnerType
            - description: >
                Partner organization subtype (required when
                type=provider_partner):

                - var: Value-Added Reseller (requires subdomain, gets portal
                access)

                - family: Family access partner (no subdomain, limited dashboard
                views)

                - court: Court system partner (no subdomain, limited dashboard
                views)

                - other: Other stakeholder partner (no subdomain, limited
                dashboard views)
        referring_partner_id:
          type: string
          format: uuid
          description: UUID of the partner organization that referred this provider (NULL
            if not referred)
        path:
          type: string
          description: ltree hierarchical path
          examples:
            - "root.org_acme_healthcare"
            - "root.org_acme_healthcare.north_campus"
        parent_path:
          type: string
          description: Parent organization ltree path (NULL for root organizations)
        tax_number:
          type: string
          maxLength: 50
          description: Tax identification number
        phone_number:
          type: string
          maxLength: 20
          description: Primary phone number
        timezone:
          type: string
          default: "America/New_York"
          description: Organization timezone
        metadata:
          type: object
          description: Additional flexible data storage

    OrganizationBusinessProfileCreatedEvent:
      title: OrganizationBusinessProfileCreatedEvent
      type: object
      required:
        - stream_id
        - stream_type
        - event_type
        - event_data
        - event_metadata
      properties:
        stream_id:
          type: string
          format: uuid
          description: Organization UUID
        stream_type:
          type: string
          const: organization
        event_type:
          type: string
          const: organization.business_profile.created
        event_data:
          $ref: '#/components/schemas/OrganizationBusinessProfileData'
        event_metadata:
          $ref: '../components/schemas.yaml#/components/schemas/EventMetadata'

    OrganizationBusinessProfileData:
      title: OrganizationBusinessProfileData
      type: object
      required:
        - organization_type
      properties:
        organization_type:
          allOf:
            - $ref: ../components/enums.yaml#/components/schemas/ImpersonationTargetOrgType
            - description: Type of business profile (platform_owner organizations don't have
                business profiles)
        mailing_address:
          $ref: '../components/schemas.yaml#/components/schemas/Address'
        physical_address:
          $ref: '../components/schemas.yaml#/components/schemas/Address'
        provider_profile:
          $ref: '#/components/schemas/ProviderBusinessProfile'
        partner_profile:
          $ref: '#/components/schemas/ProviderPartnerBusinessProfile'

    ProviderBusinessProfile:
      title: ProviderBusinessProfile
      type: object
      description: Business profile for Provider organizations (from Tenant-Management.png)
      required:
        - administrator_name
        - administrator_email
        - main_phone_number
        - email
        - program_name
      properties:
        # Billing Information (Provider-specific)
        billing_name:
          type: string
          maxLength: 200
        billing_tax:
          type: string
          maxLength: 50
        billing_address:
          $ref: '../components/schemas.yaml#/components/schemas/Address'

        # Provider Admin
        administrator_name:
          type: string
          maxLength: 200
        administrator_email:
          type: string
          format: email
        email_provider:
          type: string
          maxLength: 100

        # Contact Information
        main_phone_number:
          type: string
          maxLength: 20
        additional_phone_number:
          type: string
          maxLength: 20
        fax_number:
          type: string
          maxLength: 20
        email:
          type: string
          format: email

        # Service Information (Provider-specific)
        service_types:
          type: array
          items:
            type: string
          description: Services offered by this provider

    ProviderPartnerBusinessProfile:
      title: ProviderPartnerBusinessProfile
      type: object
      description: Business profile for Provider Partner organizations (from
        Tenant-Management-Provider-Partner.png)
      required:
        - contact_name
        - contact_email
        - contact_phone
        - administrator_name
        - administrator_email
      properties:
        # Contact Information
        contact_name:
          type: string
          maxLength: 200
        contact_address:
          $ref: '../components/schemas.yaml#/components/schemas/Address'
        contact_email:
          type: string
          format: email
        contact_phone:
          type: string
          maxLength: 20

        # Provider Partner Admin
        administrator_name:
          type: string
          maxLength: 200
        administrator_email:
          type: string
          format: email
        email_provider:
          type: string
          maxLength: 100

        # Partner-specific metadata
        partner_type:
          allOf:
            - $ref: ../components/enums.yaml#/components/schemas/PartnerType
            - description: |
                Type of provider partner relationship:
                - var: Value-Added Reseller (gets portal access)
                - family: Family access partner (limited dashboard views)
                - court: Court system partner (limited dashboard views)
                - other: Other stakeholder partner (limited dashboard views)

    OrganizationDeactivatedEvent:
      title: OrganizationDeactivatedEvent
      type: object
      required:
        - stream_id
        - stream_type
        - event_type
        - event_data
        - event_metadata
      properties:
        stream_id:
          type: string
          format: uuid
        stream_type:
          type: string
          const: organization
        event_type:
          type: string
          const: organization.deactivated
        event_data:
          $ref: '#/components/schemas/OrganizationDeactivationData'
        event_metadata:
          $ref: '../components/schemas.yaml#/components/schemas/EventMetadata'

    OrganizationDeactivationData:
      title: OrganizationDeactivationData
      type: object
      required:
        - organization_id
        - deactivation_type
        - effective_date
        - cascade_to_children
        - login_blocked
        - role_assignment_blocked
        - existing_users_affected
      properties:
        organization_id:
          type: string
          format: uuid
        deactivation_type:
          $ref: ../components/enums.yaml#/components/schemas/DeactivationReason
        effective_date:
          type: string
          format: date-time
        cascade_to_children:
          type: boolean
          description: Whether deactivation affects child organizations
        login_blocked:
          type: boolean
          description: Whether authentication is blocked (Platform Owner use case)
        role_assignment_blocked:
          type: boolean
          description: Whether new role assignments are blocked (Descendant OU use case)
        existing_users_affected:
          type: boolean
          description: Whether current user sessions are terminated
        reactivation_conditions:
          type: array
          items:
            type: string
          description: Conditions that must be met for reactivation

    OrganizationDeletedEvent:
      title: OrganizationDeletedEvent
      type: object
      required:
        - stream_id
        - stream_type
        - event_type
        - event_data
        - event_metadata
      properties:
        stream_id:
          type: string
          format: uuid
        stream_type:
          type: string
          const: organization
        event_type:
          type: string
          const: organization.deleted
        event_data:
          $ref: '#/components/schemas/OrganizationDeletionData'
        event_metadata:
          $ref: '../components/schemas.yaml#/components/schemas/EventMetadata'

    OrganizationDeletionData:
      title: OrganizationDeletionData
      type: object
      required:
        - organization_id
        - deleted_path
        - deletion_strategy
        - cascade_confirmed
      properties:
        organization_id:
          type: string
          format: uuid
        deleted_path:
          type: string
          description: ltree path being deleted
          examples:
            - "root.org_acme_healthcare.north_campus"
        deletion_strategy:
          allOf:
            - $ref: ../components/enums.yaml#/components/schemas/DeletionStrategy
            - description: How to handle child organizations
        cascade_confirmed:
          type: boolean
          description: User explicitly confirmed cascade deletion of children

    # Organization Update Event - emitted when organization properties change
    OrganizationUpdatedEvent:
      title: OrganizationUpdatedEvent
      type: object
      required:
        - stream_id
        - stream_type
        - event_type
        - event_data
        - event_metadata
      properties:
        stream_id:
          type: string
          format: uuid
          description: Organization UUID
        stream_type:
          type: string
          const: organization
        event_type:
          type: string
          const: organization.updated
        event_data:
          $ref: '#/components/schemas/OrganizationUpdateData'
        event_metadata:
          $ref: '../components/schemas.yaml#/components/schemas/EventMetadata'

    OrganizationUpdateData:
      title: OrganizationUpdateData
      type: object
      required:
        - organization_id
        - updatable_fields
      properties:
        organization_id:
          type: string
          format: uuid
          description: UUID of the organization being updated
        name:
          type: string
          maxLength: 200
          description: Updated organization name (only present if changed)
        display_name:
          type: string
          maxLength: 200
          description: Updated display name (only present if changed)
        timezone:
          type: string
          description: Updated timezone (only present if changed)
          examples:
            - "America/New_York"
            - "America/Chicago"
            - "America/Los_Angeles"
        is_active:
          type: boolean
          description: Updated active status (only present if changed)
        updatable_fields:
          type: array
          items:
            $ref: ../components/enums.yaml#/components/schemas/OrgUpdatableFields
          description: List of fields that can be updated on an organization
          examples:
            - [ "name", "display_name" ]
            - [ "timezone" ]
            - [ "is_active" ]
        previous_values:
          type: object
          description: Previous values of updated fields (for audit trail)
          additionalProperties: true

    OrganizationBusinessProfileUpdatedEvent:
      title: OrganizationBusinessProfileUpdatedEvent
      type: object
      properties:
        stream_id:
          type: string
          format: uuid
        stream_type:
          type: string
          const: organization
        event_type:
          type: string
          const: organization.business_profile.updated

    OrganizationReactivatedEvent:
      title: OrganizationReactivatedEvent
      type: object
      properties:
        stream_id:
          type: string
          format: uuid
        stream_type:
          type: string
          const: organization
        event_type:
          type: string
          const: organization.reactivated

    # Bootstrap Event Schemas
    OrganizationBootstrapInitiatedEvent:
      title: OrganizationBootstrapInitiatedEvent
      type: object
      required:
        - stream_id
        - stream_type
        - event_type
        - event_data
        - event_metadata
      properties:
        stream_id:
          type: string
          format: uuid
          description: Organization UUID (generated for new org)
        stream_type:
          type: string
          const: organization
        event_type:
          type: string
          const: organization.bootstrap.initiated
        event_data:
          $ref: '#/components/schemas/OrganizationBootstrapInitiationData'
        event_metadata:
          $ref: '../components/schemas.yaml#/components/schemas/EventMetadata'

    OrganizationBootstrapInitiationData:
      title: OrganizationBootstrapInitiationData
      type: object
      required:
        - organization_type
        - organization_name
        - admin_email
        - bootstrap_id
      properties:
        bootstrap_id:
          type: string
          format: uuid
          description: Unique identifier for this bootstrap process (for tracking)
        organization_type:
          allOf:
            - $ref: ../components/enums.yaml#/components/schemas/ImpersonationTargetOrgType
            - description: Type of organization being bootstrapped
        organization_name:
          type: string
          maxLength: 200
          description: Human-readable organization name
          examples:
            - "ACME Healthcare Services"
            - "XYZ Consulting Partners"
        admin_email:
          type: string
          format: email
          description: Email address for the initial organization administrator
          examples:
            - "admin@acmehealthcare.com"
            - "director@xyzconsulting.com"
        slug:
          type: string
          pattern: '^[a-z0-9_]+$'
          description: URL-safe organization identifier (auto-generated if not provided)
          examples:
            - "acme_healthcare"
            - "xyz_consulting"
        timezone:
          type: string
          default: "America/New_York"
          description: Organization timezone (IANA format)
        # Reference-based entity inputs (with temp_id/contact_ref correlation)
        contacts:
          type: array
          items:
            $ref: '#/components/schemas/BootstrapContactInput'
          description: Contacts to create (each has temp_id for correlation)
        phones:
          type: array
          items:
            $ref: '#/components/schemas/BootstrapPhoneInput'
          description: Phones to create (contact_ref links to contact temp_id, null = org-level)
        emails:
          type: array
          items:
            $ref: '#/components/schemas/BootstrapEmailInput'
          description: Emails to create (contact_ref links to contact temp_id, null = org-level)
        addresses:
          type: array
          items:
            $ref: '#/components/schemas/BootstrapAddressInput'
          description: Addresses to create (contact_ref links to contact temp_id, null = org-level)

    OrganizationBootstrapCompletedEvent:
      title: OrganizationBootstrapCompletedEvent
      type: object
      required:
        - stream_id
        - stream_type
        - event_type
        - event_data
        - event_metadata
      properties:
        stream_id:
          type: string
          format: uuid
        stream_type:
          type: string
          const: organization
        event_type:
          type: string
          const: organization.bootstrap.completed
        event_data:
          $ref: '#/components/schemas/OrganizationBootstrapCompletionData'
        event_metadata:
          $ref: '../components/schemas.yaml#/components/schemas/EventMetadata'

    OrganizationBootstrapCompletionData:
      title: OrganizationBootstrapCompletionData
      type: object
      required:
        - bootstrap_id
        - organization_id
        - admin_role_assigned
        - permissions_granted
      properties:
        bootstrap_id:
          type: string
          format: uuid
        organization_id:
          type: string
          format: uuid
        admin_role_assigned:
          allOf:
            - $ref: ../components/enums.yaml#/components/schemas/AdminRole
            - description: Role assigned to the initial administrator
        permissions_granted:
          type: integer
          description: Number of permissions granted to the admin role
        ltree_path:
          type: string
          description: Organization ltree path in hierarchy
          examples:
            - "root.org_acme_healthcare"

    OrganizationBootstrapFailedEvent:
      title: OrganizationBootstrapFailedEvent
      type: object
      required:
        - stream_id
        - stream_type
        - event_type
        - event_data
        - event_metadata
      properties:
        stream_id:
          type: string
          format: uuid
        stream_type:
          type: string
          const: organization
        event_type:
          type: string
          const: organization.bootstrap.failed
        event_data:
          $ref: '#/components/schemas/OrganizationBootstrapFailureData'
        event_metadata:
          $ref: '../components/schemas.yaml#/components/schemas/EventMetadata'

    OrganizationBootstrapFailureData:
      title: OrganizationBootstrapFailureData
      type: object
      required:
        - bootstrap_id
        - failure_stage
        - error_message
      properties:
        bootstrap_id:
          type: string
          format: uuid
        failure_stage:
          allOf:
            - $ref: ../components/enums.yaml#/components/schemas/BootstrapFailureStage
            - description: Stage where bootstrap process failed
        error_message:
          type: string
          description: Error details for troubleshooting
        partial_cleanup_required:
          type: boolean
          description: Whether partial resources need cleanup
          default: false

    OrganizationBootstrapCancelledEvent:
      title: OrganizationBootstrapCancelledEvent
      type: object
      required:
        - stream_id
        - stream_type
        - event_type
        - event_data
        - event_metadata
      properties:
        stream_id:
          type: string
          format: uuid
        stream_type:
          type: string
          const: organization
        event_type:
          type: string
          const: organization.bootstrap.cancelled
        event_data:
          $ref: '#/components/schemas/OrganizationBootstrapCancellationData'
        event_metadata:
          $ref: '../components/schemas.yaml#/components/schemas/EventMetadata'

    OrganizationBootstrapCancellationData:
      title: OrganizationBootstrapCancellationData
      type: object
      required:
        - bootstrap_id
        - cleanup_completed
      properties:
        bootstrap_id:
          type: string
          format: uuid
        cleanup_completed:
          type: boolean
          description: Whether all partial resources were successfully cleaned up
        cleanup_actions:
          type: array
          items:
            type: string
          description: List of cleanup actions performed
          examples:
            - "removed_dns_records"
            - "removed_partial_database_records"
            - "deleted_pending_invitations"
        original_failure_stage:
          type: string
          description: Original stage where bootstrap failed

    # Subdomain Provisioning Event Schemas
    OrganizationSubdomainDnsCreatedEvent:
      title: OrganizationSubdomainDnsCreatedEvent
      type: object
      required:
        - stream_id
        - stream_type
        - event_type
        - event_data
        - event_metadata
      properties:
        stream_id:
          type: string
          format: uuid
          description: Organization UUID
        stream_type:
          type: string
          const: organization
        event_type:
          type: string
          const: organization.subdomain.dns_created
        event_data:
          $ref: '#/components/schemas/SubdomainDnsCreatedData'
        event_metadata:
          $ref: '../components/schemas.yaml#/components/schemas/EventMetadata'

    SubdomainDnsCreatedData:
      title: SubdomainDnsCreatedData
      type: object
      required:
        - subdomain
        - cloudflare_record_id
        - dns_record_type
        - dns_record_value
      properties:
        subdomain:
          type: string
          description: Subdomain name (e.g., "acme-healthcare")
          examples:
            - "acme-healthcare"
            - "poc-test1-20251212"
        cloudflare_record_id:
          type: string
          description: Cloudflare DNS record ID
        cloudflare_zone_id:
          type: string
          description: Cloudflare zone ID
        dns_record_type:
          allOf:
            - $ref: ../components/enums.yaml#/components/schemas/DNSRecordType
            - description: DNS record type
        dns_record_value:
          type: string
          description: DNS record target value
          examples:
            - "a4c.firstovertheline.com"

    OrganizationSubdomainVerifiedEvent:
      title: OrganizationSubdomainVerifiedEvent
      type: object
      required:
        - stream_id
        - stream_type
        - event_type
        - event_data
        - event_metadata
      properties:
        stream_id:
          type: string
          format: uuid
          description: Organization UUID
        stream_type:
          type: string
          const: organization
        event_type:
          type: string
          const: organization.subdomain.verified
        event_data:
          $ref: '#/components/schemas/SubdomainVerifiedData'
        event_metadata:
          $ref: '../components/schemas.yaml#/components/schemas/EventMetadata'

    SubdomainVerifiedData:
      title: SubdomainVerifiedData
      type: object
      required:
        - domain
        - verified
        - verified_at
      properties:
        domain:
          type: string
          description: Full domain that was verified
          examples:
            - "acme-healthcare.firstovertheline.com"
        verified:
          type: boolean
          description: Whether DNS verification succeeded
        verified_at:
          type: string
          format: date-time
          description: Timestamp when verification completed
        verification_method:
          allOf:
            - $ref: ../components/enums.yaml#/components/schemas/VerificationMethod
            - description: Method used for verification (dns_quorum for production,
                development for dev mode)
        verification_attempts:
          type: integer
          description: Number of verification attempts made
        mode:
          allOf:
            - $ref: ../components/enums.yaml#/components/schemas/VerificationMode
            - description: Workflow execution mode

    OrganizationSubdomainVerificationFailedEvent:
      title: OrganizationSubdomainVerificationFailedEvent
      type: object
      required:
        - stream_id
        - stream_type
        - event_type
        - event_data
        - event_metadata
      properties:
        stream_id:
          type: string
          format: uuid
          description: Organization UUID
        stream_type:
          type: string
          const: organization
        event_type:
          type: string
          const: organization.subdomain.verification_failed
        event_data:
          $ref: '#/components/schemas/SubdomainVerificationFailedData'
        event_metadata:
          $ref: '../components/schemas.yaml#/components/schemas/EventMetadata'

    SubdomainVerificationFailedData:
      title: SubdomainVerificationFailedData
      type: object
      required:
        - domain
        - failure_reason
      properties:
        domain:
          type: string
          description: Full domain that failed verification
        failure_reason:
          type: string
          description: Reason for verification failure
          examples:
            - "DNS_TIMEOUT"
            - "CNAME_NOT_FOUND"
            - "WRONG_TARGET"
        retry_count:
          type: integer
          description: Number of retries attempted
        will_retry:
          type: boolean
          description: Whether verification will be retried

    # Organization Activated Event (bootstrap completion)
    OrganizationActivatedEvent:
      title: OrganizationActivatedEvent
      type: object
      required:
        - stream_id
        - stream_type
        - event_type
        - event_data
        - event_metadata
      properties:
        stream_id:
          type: string
          format: uuid
          description: Organization UUID
        stream_type:
          type: string
          const: organization
        event_type:
          type: string
          const: organization.activated
        event_data:
          $ref: '#/components/schemas/OrganizationActivatedData'
        event_metadata:
          $ref: '../components/schemas.yaml#/components/schemas/EventMetadata'

    OrganizationActivatedData:
      title: OrganizationActivatedData
      type: object
      required:
        - org_id
        - activated_at
      properties:
        org_id:
          type: string
          format: uuid
          description: Organization UUID
        activated_at:
          type: string
          format: date-time
          description: Timestamp when organization was activated
        previous_is_active:
          type: boolean
          description: Previous active status (for idempotency tracking)

    # Organization DNS Removed Event (compensation/cleanup)
    OrganizationDnsRemovedEvent:
      title: OrganizationDnsRemovedEvent
      type: object
      required:
        - stream_id
        - stream_type
        - event_type
        - event_data
        - event_metadata
      properties:
        stream_id:
          type: string
          format: uuid
          description: Organization UUID
        stream_type:
          type: string
          const: organization
        event_type:
          type: string
          const: organization.dns.removed
        event_data:
          $ref: '#/components/schemas/OrganizationDnsRemovedData'
        event_metadata:
          $ref: '../components/schemas.yaml#/components/schemas/EventMetadata'

    OrganizationDnsRemovedData:
      title: OrganizationDnsRemovedData
      type: object
      required:
        - subdomain
        - fqdn
        - status
      properties:
        subdomain:
          type: string
          description: Subdomain name that was removed
          examples:
            - "acme-healthcare"
        fqdn:
          type: string
          description: Fully qualified domain name
          examples:
            - "acme-healthcare.firstovertheline.com"
        record_id:
          type: string
          description: Cloudflare DNS record ID (when successfully deleted)
        status:
          $ref: '../components/enums.yaml#/components/schemas/DNSRemovalStatus'
        error:
          type: string
          description: Error message (when status is 'error')

    # ==========================================================================
    # Bootstrap Input Types (with temp_id/contact_ref correlation)
    # ==========================================================================

    BootstrapContactInput:
      title: BootstrapContactInput
      type: object
      description: Contact input for bootstrap workflow with temp_id for correlation
      required:
        - temp_id
        - label
        - type
        - first_name
        - last_name
      properties:
        temp_id:
          type: string
          description: Temporary ID for correlation during bootstrap (maps to real UUID)
          examples:
            - "contact-1"
            - "contact-admin"
        label:
          type: string
          maxLength: 200
          description: User-defined contact label
          examples:
            - "Primary Administrator"
            - "Billing Contact"
        type:
          $ref: ../components/enums.yaml#/components/schemas/ContactType
        first_name:
          type: string
          maxLength: 100
          description: Contact first name
        last_name:
          type: string
          maxLength: 100
          description: Contact last name
        email:
          type: string
          format: email
          description: Contact's direct email (for contact record, not separate email entity)
        title:
          type: string
          maxLength: 100
          description: Job title
        department:
          type: string
          maxLength: 100
          description: Department
        is_primary:
          type: boolean
          default: false
          description: Whether this is the primary contact

    BootstrapPhoneInput:
      title: BootstrapPhoneInput
      type: object
      description: Phone input for bootstrap workflow with contact correlation
      required:
        - temp_id
        - label
        - type
        - number
      properties:
        temp_id:
          type: string
          description: Temporary ID for this phone
          examples:
            - "phone-1"
            - "phone-main"
        contact_ref:
          type: string
          nullable: true
          description: temp_id of contact to link to (null = org-level only)
          examples:
            - "contact-1"
            - null
        label:
          type: string
          maxLength: 200
          description: Phone label
          examples:
            - "Main Office"
            - "Emergency Hotline"
        type:
          $ref: ../components/enums.yaml#/components/schemas/PhoneType
        number:
          type: string
          maxLength: 20
          description: Phone number
          examples:
            - "+1-555-123-4567"
        extension:
          type: string
          maxLength: 10
          description: Phone extension
        is_primary:
          type: boolean
          default: false
          description: Whether this is the primary phone

    BootstrapEmailInput:
      title: BootstrapEmailInput
      type: object
      description: Email input for bootstrap workflow with contact correlation
      required:
        - temp_id
        - label
        - type
        - address
      properties:
        temp_id:
          type: string
          description: Temporary ID for this email
          examples:
            - "email-1"
            - "email-info"
        contact_ref:
          type: string
          nullable: true
          description: temp_id of contact to link to (null = org-level only)
          examples:
            - "contact-1"
            - null
        label:
          type: string
          maxLength: 200
          description: Email label
          examples:
            - "Main Office"
            - "Billing Department"
        type:
          $ref: ../components/enums.yaml#/components/schemas/EmailType
        address:
          type: string
          format: email
          description: Email address
          examples:
            - "info@acme-healthcare.com"
            - "billing@acme-healthcare.com"
        is_primary:
          type: boolean
          default: false
          description: Whether this is the primary email

    BootstrapAddressInput:
      title: BootstrapAddressInput
      type: object
      description: Address input for bootstrap workflow with contact correlation
      required:
        - temp_id
        - label
        - type
        - street1
        - city
        - state
        - zip_code
      properties:
        temp_id:
          type: string
          description: Temporary ID for this address
          examples:
            - "addr-1"
            - "addr-main"
        contact_ref:
          type: string
          nullable: true
          description: temp_id of contact to link to (null = org-level only)
          examples:
            - "contact-1"
            - null
        label:
          type: string
          maxLength: 200
          description: Address label
          examples:
            - "Main Office"
            - "Billing Address"
        type:
          $ref: ../components/enums.yaml#/components/schemas/AddressType
        street1:
          type: string
          maxLength: 255
          description: Street address line 1
        street2:
          type: string
          maxLength: 255
          description: Street address line 2
        city:
          type: string
          maxLength: 100
          description: City
        state:
          type: string
          maxLength: 50
          description: State/Province
        zip_code:
          type: string
          maxLength: 20
          description: ZIP/Postal code
        country:
          type: string
          maxLength: 3
          default: "US"
          description: Country code (ISO 3166-1 alpha-2 or alpha-3)
        is_primary:
          type: boolean
          default: false
          description: Whether this is the primary address

    # ==========================================================================
    # Direct Care Settings Event Schemas
    # ==========================================================================

    OrganizationDirectCareSettingsUpdatedEvent:
      title: OrganizationDirectCareSettingsUpdatedEvent
      type: object
      required:
        - stream_id
        - stream_type
        - event_type
        - event_data
        - event_metadata
      properties:
        stream_id:
          type: string
          format: uuid
          description: Organization UUID
        stream_type:
          type: string
          const: organization
        event_type:
          type: string
          const: organization.direct_care_settings_updated
        event_data:
          $ref: '#/components/schemas/DirectCareSettingsUpdateData'
        event_metadata:
          $ref: '../components/schemas.yaml#/components/schemas/EventMetadata'

    DirectCareSettingsUpdateData:
      title: DirectCareSettingsUpdateData
      type: object
      required:
        - organization_id
        - settings
      properties:
        organization_id:
          type: string
          format: uuid
          description: Organization UUID
        settings:
          $ref: '#/components/schemas/DirectCareSettings'
        previous_settings:
          $ref: '#/components/schemas/DirectCareSettings'

    DirectCareSettings:
      title: DirectCareSettings
      type: object
      description: Feature flags for direct care workflow routing
      properties:
        enable_staff_client_mapping:
          type: boolean
          default: false
          description: |
            When true: Notifications go only to staff assigned to the specific client.
            When false: Notifications go to all staff at the client's org unit.
        enable_schedule_enforcement:
          type: boolean
          default: false
          description: |
            When true: Only staff currently on schedule receive notifications.
            When false: Any staff (assigned or at OU) receive notifications.
