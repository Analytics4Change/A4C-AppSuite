asyncapi: 2.6.0
info:
  title: A4C Domain Events
  version: 1.0.0
  description: |
    Event-driven architecture specification for Analytics4Change platform.
    All events capture WHO, WHAT, WHEN, and most importantly WHY changes occur.
  contact:
    name: A4C Development Team
  license:
    name: Private
servers:
  development:
    url: postgresql://localhost:54322/postgres
    protocol: postgresql
    description: Local Supabase development instance
  production:
    url: postgresql://{project-ref}.supabase.co:5432/postgres
    protocol: postgresql
    description: Production Supabase instance
    variables:
      project-ref:
        default: tmrjlswbsxmbglmaclxu
        description: Supabase project reference
defaultContentType: application/json
channels:
  domain_events:
    description: Main event stream for all domain events
    publish:
      summary: Publish domain events to the system
      operationId: publishDomainEvent
      message:
        oneOf:
          - name: client.registered
            title: Client Registered
            summary: A new client has been registered in the system
            contentType: application/json
            payload:
              type: object
              required:
                - stream_id
                - stream_type
                - event_type
                - event_data
                - event_metadata
              properties:
                stream_id:
                  type: string
                  format: uuid
                  description: The client ID
                stream_type:
                  type: string
                  const: client
                event_type:
                  type: string
                  const: client.registered
                event_data:
                  type: object
                  required:
                    - organization_id
                    - first_name
                    - last_name
                    - date_of_birth
                  properties:
                    organization_id:
                      type: string
                      format: uuid
                      description: Organization this client belongs to
                    first_name:
                      type: string
                      minLength: 1
                      maxLength: 100
                      pattern: ^[a-zA-Z\s\-'\.]+$
                      description: Client's legal first name
                    last_name:
                      type: string
                      minLength: 1
                      maxLength: 100
                      pattern: ^[a-zA-Z\s\-'\.]+$
                      description: Client's legal last name
                    date_of_birth:
                      type: string
                      format: date
                      description: Client's date of birth (YYYY-MM-DD)
                    gender:
                      type: string
                      enum:
                        - male
                        - female
                        - other
                        - prefer_not_to_say
                      description: Client's gender identity
                    email:
                      type: string
                      format: email
                      maxLength: 255
                      description: Client's email address
                    phone:
                      type: string
                      pattern: ^\+?1?\d{10,14}$
                      description: Client's primary phone number
                    address:
                      type: object
                      properties:
                        street:
                          type: string
                          maxLength: 200
                        city:
                          type: string
                          maxLength: 100
                        state:
                          type: string
                          maxLength: 2
                          pattern: ^[A-Z]{2}$
                        zip_code:
                          type: string
                          pattern: ^\d{5}(-\d{4})?$
                        country:
                          type: string
                          default: USA
                          maxLength: 100
                    emergency_contact:
                      type: object
                      required:
                        - name
                        - relationship
                        - phone
                      properties:
                        name:
                          type: string
                          maxLength: 200
                        relationship:
                          type: string
                          enum:
                            - parent
                            - guardian
                            - spouse
                            - sibling
                            - child
                            - friend
                            - other
                        phone:
                          type: string
                          pattern: ^\+?1?\d{10,14}$
                        alternate_phone:
                          type: string
                          pattern: ^\+?1?\d{10,14}$
                        email:
                          type: string
                          format: email
                    allergies:
                      type: array
                      description: Known allergies
                      items:
                        type: string
                        maxLength: 200
                    medical_conditions:
                      type: array
                      description: Pre-existing medical conditions
                      items:
                        type: string
                        maxLength: 200
                    blood_type:
                      type: string
                      enum:
                        - A+
                        - A-
                        - B+
                        - B-
                        - AB+
                        - AB-
                        - O+
                        - O-
                      description: Client's blood type
                    insurance_provider:
                      type: string
                      maxLength: 200
                      description: Primary insurance provider
                    insurance_policy_number:
                      type: string
                      maxLength: 100
                      description: Insurance policy number
                    notes:
                      type: string
                      maxLength: 2000
                      description: Additional registration notes
                event_metadata:
                  allOf:
                    - type: object
                      required:
                        - user_id
                        - reason
                      properties:
                        user_id:
                          type: string
                          format: uuid
                          description: ID of the user who initiated this event
                        reason:
                          type: string
                          minLength: 10
                          maxLength: 500
                          description: >
                            Business justification for this action. This field
                            captures the "WHY"

                            behind every change and is REQUIRED for all events.
                          examples:
                            - >-
                              Patient showed allergic reaction to previous
                              medication
                            - >-
                              Dosage adjustment per physician consultation on
                              2024-01-15
                            - >-
                              Regular intake from emergency department referral
                              #12345
                        user_email:
                          type: string
                          format: email
                          description: Email of the user who initiated this event
                        user_name:
                          type: string
                          description: Name of the user who initiated this event
                        correlation_id:
                          type: string
                          format: uuid
                          description: ID to correlate related events across the system
                        causation_id:
                          type: string
                          format: uuid
                          description: ID of the event that caused this event
                        ip_address:
                          type: string
                          format: ipv4
                          description: IP address of the client
                        user_agent:
                          type: string
                          description: User agent string of the client
                        approval_chain:
                          type: array
                          description: Chain of approvals for this action
                          items:
                            type: object
                            required:
                              - approver_id
                              - approved_at
                              - role
                            properties:
                              approver_id:
                                type: string
                                format: uuid
                                description: ID of the approver
                              approver_name:
                                type: string
                                description: Name of the approver
                              approver_email:
                                type: string
                                format: email
                              approved_at:
                                type: string
                                format: date-time
                                description: When approval was granted
                              role:
                                type: string
                                enum:
                                  - physician
                                  - nurse_practitioner
                                  - pharmacist
                                  - administrator
                                  - supervisor
                                description: Role of the approver
                              notes:
                                type: string
                                description: Approval notes or conditions
                        notes:
                          type: string
                          maxLength: 2000
                          description: Additional context or notes
                    - type: object
                      required:
                        - reason
                      properties:
                        reason:
                          examples:
                            - >-
                              Initial intake from emergency department referral
                              #12345
                            - >-
                              Transfer from pediatric unit per Dr. Smith's
                              discharge summary
                            - >-
                              New admission for outpatient therapy program
                              starting 2024-02-01
          - name: client.admitted
            title: Client Admitted
            summary: A client has been admitted to a facility
            contentType: application/json
            payload:
              type: object
              required:
                - stream_id
                - stream_type
                - event_type
                - event_data
                - event_metadata
              properties:
                stream_id:
                  type: string
                  format: uuid
                stream_type:
                  type: string
                  const: client
                event_type:
                  type: string
                  const: client.admitted
                event_data:
                  type: object
                  required:
                    - admission_date
                    - facility_id
                    - admission_type
                  properties:
                    admission_date:
                      type: string
                      format: date
                      description: Date of admission
                    facility_id:
                      type: string
                      format: uuid
                      description: Facility where client is admitted
                    admission_type:
                      type: string
                      enum:
                        - scheduled
                        - emergency
                        - transfer
                        - readmission
                      description: Type of admission
                    referring_provider:
                      type: string
                      maxLength: 200
                      description: Name of referring provider
                    referring_organization:
                      type: string
                      maxLength: 200
                      description: Referring organization
                    primary_diagnosis:
                      type: string
                      maxLength: 500
                      description: Primary diagnosis or reason for admission
                    secondary_diagnoses:
                      type: array
                      items:
                        type: string
                        maxLength: 500
                    expected_length_of_stay:
                      type: integer
                      minimum: 1
                      maximum: 365
                      description: Expected length of stay in days
                    admission_notes:
                      type: string
                      maxLength: 5000
                event_metadata:
                  allOf:
                    - type: object
                      required:
                        - user_id
                        - reason
                      properties:
                        user_id:
                          type: string
                          format: uuid
                          description: ID of the user who initiated this event
                        reason:
                          type: string
                          minLength: 10
                          maxLength: 500
                          description: >
                            Business justification for this action. This field
                            captures the "WHY"

                            behind every change and is REQUIRED for all events.
                          examples:
                            - >-
                              Patient showed allergic reaction to previous
                              medication
                            - >-
                              Dosage adjustment per physician consultation on
                              2024-01-15
                            - >-
                              Regular intake from emergency department referral
                              #12345
                        user_email:
                          type: string
                          format: email
                          description: Email of the user who initiated this event
                        user_name:
                          type: string
                          description: Name of the user who initiated this event
                        correlation_id:
                          type: string
                          format: uuid
                          description: ID to correlate related events across the system
                        causation_id:
                          type: string
                          format: uuid
                          description: ID of the event that caused this event
                        ip_address:
                          type: string
                          format: ipv4
                          description: IP address of the client
                        user_agent:
                          type: string
                          description: User agent string of the client
                        approval_chain:
                          type: array
                          description: Chain of approvals for this action
                          items:
                            type: object
                            required:
                              - approver_id
                              - approved_at
                              - role
                            properties:
                              approver_id:
                                type: string
                                format: uuid
                                description: ID of the approver
                              approver_name:
                                type: string
                                description: Name of the approver
                              approver_email:
                                type: string
                                format: email
                              approved_at:
                                type: string
                                format: date-time
                                description: When approval was granted
                              role:
                                type: string
                                enum:
                                  - physician
                                  - nurse_practitioner
                                  - pharmacist
                                  - administrator
                                  - supervisor
                                description: Role of the approver
                              notes:
                                type: string
                                description: Approval notes or conditions
                        notes:
                          type: string
                          maxLength: 2000
                          description: Additional context or notes
                    - type: object
                      required:
                        - reason
                      properties:
                        reason:
                          examples:
                            - >-
                              Scheduled admission for substance abuse treatment
                              program
                            - >-
                              Emergency admission due to mental health crisis
                              per court order #2024-123
                            - >-
                              Routine admission for medication stabilization and
                              monitoring
          - name: client.information_updated
            title: Client Information Updated
            summary: Client information has been modified
            contentType: application/json
            payload:
              type: object
              required:
                - stream_id
                - stream_type
                - event_type
                - event_data
                - event_metadata
              properties:
                stream_id:
                  type: string
                  format: uuid
                stream_type:
                  type: string
                  const: client
                event_type:
                  type: string
                  const: client.information_updated
                event_data:
                  type: object
                  required:
                    - changes
                  properties:
                    changes:
                      type: object
                      description: Fields that were changed (only include changed fields)
                      properties:
                        first_name:
                          type: string
                        last_name:
                          type: string
                        email:
                          type: string
                          format: email
                        phone:
                          type: string
                        address:
                          type: object
                          properties:
                            street:
                              type: string
                              maxLength: 200
                            city:
                              type: string
                              maxLength: 100
                            state:
                              type: string
                              maxLength: 2
                              pattern: ^[A-Z]{2}$
                            zip_code:
                              type: string
                              pattern: ^\d{5}(-\d{4})?$
                            country:
                              type: string
                              default: USA
                              maxLength: 100
                        emergency_contact:
                          type: object
                          required:
                            - name
                            - relationship
                            - phone
                          properties:
                            name:
                              type: string
                              maxLength: 200
                            relationship:
                              type: string
                              enum:
                                - parent
                                - guardian
                                - spouse
                                - sibling
                                - child
                                - friend
                                - other
                            phone:
                              type: string
                              pattern: ^\+?1?\d{10,14}$
                            alternate_phone:
                              type: string
                              pattern: ^\+?1?\d{10,14}$
                            email:
                              type: string
                              format: email
                        allergies:
                          type: array
                          items:
                            type: string
                        medical_conditions:
                          type: array
                          items:
                            type: string
                        blood_type:
                          type: string
                        insurance_provider:
                          type: string
                        insurance_policy_number:
                          type: string
                        notes:
                          type: string
                    previous_values:
                      type: object
                      description: Previous values of changed fields (for audit trail)
                event_metadata:
                  allOf:
                    - type: object
                      required:
                        - user_id
                        - reason
                      properties:
                        user_id:
                          type: string
                          format: uuid
                          description: ID of the user who initiated this event
                        reason:
                          type: string
                          minLength: 10
                          maxLength: 500
                          description: >
                            Business justification for this action. This field
                            captures the "WHY"

                            behind every change and is REQUIRED for all events.
                          examples:
                            - >-
                              Patient showed allergic reaction to previous
                              medication
                            - >-
                              Dosage adjustment per physician consultation on
                              2024-01-15
                            - >-
                              Regular intake from emergency department referral
                              #12345
                        user_email:
                          type: string
                          format: email
                          description: Email of the user who initiated this event
                        user_name:
                          type: string
                          description: Name of the user who initiated this event
                        correlation_id:
                          type: string
                          format: uuid
                          description: ID to correlate related events across the system
                        causation_id:
                          type: string
                          format: uuid
                          description: ID of the event that caused this event
                        ip_address:
                          type: string
                          format: ipv4
                          description: IP address of the client
                        user_agent:
                          type: string
                          description: User agent string of the client
                        approval_chain:
                          type: array
                          description: Chain of approvals for this action
                          items:
                            type: object
                            required:
                              - approver_id
                              - approved_at
                              - role
                            properties:
                              approver_id:
                                type: string
                                format: uuid
                                description: ID of the approver
                              approver_name:
                                type: string
                                description: Name of the approver
                              approver_email:
                                type: string
                                format: email
                              approved_at:
                                type: string
                                format: date-time
                                description: When approval was granted
                              role:
                                type: string
                                enum:
                                  - physician
                                  - nurse_practitioner
                                  - pharmacist
                                  - administrator
                                  - supervisor
                                description: Role of the approver
                              notes:
                                type: string
                                description: Approval notes or conditions
                        notes:
                          type: string
                          maxLength: 2000
                          description: Additional context or notes
                    - type: object
                      required:
                        - reason
                      properties:
                        reason:
                          examples:
                            - >-
                              Updated emergency contact per client's request
                              during intake
                            - >-
                              Corrected date of birth based on verified
                              government ID
                            - >-
                              Added new allergy discovered during medication
                              administration
                            - >-
                              Updated address after client relocation
                              notification
          - name: client.discharged
            title: Client Discharged
            summary: A client has been discharged from a facility
            contentType: application/json
            payload:
              type: object
              required:
                - stream_id
                - stream_type
                - event_type
                - event_data
                - event_metadata
              properties:
                stream_id:
                  type: string
                  format: uuid
                stream_type:
                  type: string
                  const: client
                event_type:
                  type: string
                  const: client.discharged
                event_data:
                  type: object
                  required:
                    - discharge_date
                    - discharge_type
                    - discharge_disposition
                  properties:
                    discharge_date:
                      type: string
                      format: date
                      description: Date of discharge
                    discharge_type:
                      type: string
                      enum:
                        - planned
                        - against_medical_advice
                        - transfer
                        - administrative
                        - death
                      description: Type of discharge
                    discharge_disposition:
                      type: string
                      enum:
                        - home
                        - home_with_services
                        - skilled_nursing_facility
                        - rehabilitation_facility
                        - acute_care_hospital
                        - psychiatric_hospital
                        - hospice
                        - deceased
                        - left_against_advice
                        - other
                      description: Where client went after discharge
                    follow_up_appointments:
                      type: array
                      items:
                        type: object
                        properties:
                          provider:
                            type: string
                          date:
                            type: string
                            format: date
                          type:
                            type: string
                    discharge_medications:
                      type: array
                      description: Medications at discharge
                      items:
                        type: string
                    discharge_instructions:
                      type: string
                      maxLength: 5000
                      description: Instructions given to client/family
                    discharge_summary:
                      type: string
                      maxLength: 10000
                      description: Clinical discharge summary
                event_metadata:
                  allOf:
                    - type: object
                      required:
                        - user_id
                        - reason
                      properties:
                        user_id:
                          type: string
                          format: uuid
                          description: ID of the user who initiated this event
                        reason:
                          type: string
                          minLength: 10
                          maxLength: 500
                          description: >
                            Business justification for this action. This field
                            captures the "WHY"

                            behind every change and is REQUIRED for all events.
                          examples:
                            - >-
                              Patient showed allergic reaction to previous
                              medication
                            - >-
                              Dosage adjustment per physician consultation on
                              2024-01-15
                            - >-
                              Regular intake from emergency department referral
                              #12345
                        user_email:
                          type: string
                          format: email
                          description: Email of the user who initiated this event
                        user_name:
                          type: string
                          description: Name of the user who initiated this event
                        correlation_id:
                          type: string
                          format: uuid
                          description: ID to correlate related events across the system
                        causation_id:
                          type: string
                          format: uuid
                          description: ID of the event that caused this event
                        ip_address:
                          type: string
                          format: ipv4
                          description: IP address of the client
                        user_agent:
                          type: string
                          description: User agent string of the client
                        approval_chain:
                          type: array
                          description: Chain of approvals for this action
                          items:
                            type: object
                            required:
                              - approver_id
                              - approved_at
                              - role
                            properties:
                              approver_id:
                                type: string
                                format: uuid
                                description: ID of the approver
                              approver_name:
                                type: string
                                description: Name of the approver
                              approver_email:
                                type: string
                                format: email
                              approved_at:
                                type: string
                                format: date-time
                                description: When approval was granted
                              role:
                                type: string
                                enum:
                                  - physician
                                  - nurse_practitioner
                                  - pharmacist
                                  - administrator
                                  - supervisor
                                description: Role of the approver
                              notes:
                                type: string
                                description: Approval notes or conditions
                        notes:
                          type: string
                          maxLength: 2000
                          description: Additional context or notes
                    - type: object
                      required:
                        - reason
                      properties:
                        reason:
                          examples:
                            - Treatment completed successfully, goals achieved
                            - >-
                              Discharged against medical advice per client
                              request
                            - >-
                              Transfer to higher level of care at regional
                              facility
                            - >-
                              Insurance coverage exhausted, transitioning to
                              outpatient
          - name: medication.added_to_formulary
            title: Medication Added to Formulary
            summary: A new medication has been added to the organization's formulary
            contentType: application/json
            payload:
              type: object
              required:
                - stream_id
                - stream_type
                - event_type
                - event_data
                - event_metadata
              properties:
                stream_id:
                  type: string
                  format: uuid
                  description: The medication ID
                stream_type:
                  type: string
                  const: medication
                event_type:
                  type: string
                  const: medication.added_to_formulary
                event_data:
                  type: object
                  required:
                    - organization_id
                    - name
                    - generic_name
                  properties:
                    organization_id:
                      type: string
                      format: uuid
                    name:
                      type: string
                      minLength: 1
                      maxLength: 200
                      description: Medication brand name
                    generic_name:
                      type: string
                      minLength: 1
                      maxLength: 200
                      description: Generic name
                    brand_names:
                      type: array
                      items:
                        type: string
                    rxnorm_cui:
                      type: string
                      pattern: ^\d+$
                      description: RXNorm Concept Unique Identifier
                    ndc_codes:
                      type: array
                      description: National Drug Codes
                      items:
                        type: string
                        pattern: ^\d{5}-\d{4}-\d{2}$
                    category_broad:
                      type: string
                      maxLength: 100
                      examples:
                        - Psychotropic
                        - Cardiovascular
                        - Antibiotic
                    category_specific:
                      type: string
                      maxLength: 100
                      examples:
                        - Antidepressant
                        - Beta Blocker
                        - Penicillin
                    drug_class:
                      type: string
                      maxLength: 100
                    is_psychotropic:
                      type: boolean
                      default: false
                    is_controlled:
                      type: boolean
                      default: false
                    controlled_substance_schedule:
                      type: string
                      enum:
                        - Schedule I
                        - Schedule II
                        - Schedule III
                        - Schedule IV
                        - Schedule V
                    is_narcotic:
                      type: boolean
                      default: false
                    requires_monitoring:
                      type: boolean
                      default: false
                    is_high_alert:
                      type: boolean
                      default: false
                    active_ingredients:
                      type: array
                      items:
                        type: object
                        properties:
                          name:
                            type: string
                          strength:
                            type: number
                          unit:
                            type: string
                    available_forms:
                      type: array
                      items:
                        type: string
                        enum:
                          - tablet
                          - capsule
                          - liquid
                          - injection
                          - patch
                          - cream
                          - ointment
                          - inhaler
                          - suppository
                    available_strengths:
                      type: array
                      items:
                        type: string
                    manufacturer:
                      type: string
                      maxLength: 200
                    warnings:
                      type: array
                      items:
                        type: string
                    black_box_warning:
                      type: string
                      maxLength: 2000
                event_metadata:
                  allOf:
                    - type: object
                      required:
                        - user_id
                        - reason
                      properties:
                        user_id:
                          type: string
                          format: uuid
                          description: ID of the user who initiated this event
                        reason:
                          type: string
                          minLength: 10
                          maxLength: 500
                          description: >
                            Business justification for this action. This field
                            captures the "WHY"

                            behind every change and is REQUIRED for all events.
                          examples:
                            - >-
                              Patient showed allergic reaction to previous
                              medication
                            - >-
                              Dosage adjustment per physician consultation on
                              2024-01-15
                            - >-
                              Regular intake from emergency department referral
                              #12345
                        user_email:
                          type: string
                          format: email
                          description: Email of the user who initiated this event
                        user_name:
                          type: string
                          description: Name of the user who initiated this event
                        correlation_id:
                          type: string
                          format: uuid
                          description: ID to correlate related events across the system
                        causation_id:
                          type: string
                          format: uuid
                          description: ID of the event that caused this event
                        ip_address:
                          type: string
                          format: ipv4
                          description: IP address of the client
                        user_agent:
                          type: string
                          description: User agent string of the client
                        approval_chain:
                          type: array
                          description: Chain of approvals for this action
                          items:
                            type: object
                            required:
                              - approver_id
                              - approved_at
                              - role
                            properties:
                              approver_id:
                                type: string
                                format: uuid
                                description: ID of the approver
                              approver_name:
                                type: string
                                description: Name of the approver
                              approver_email:
                                type: string
                                format: email
                              approved_at:
                                type: string
                                format: date-time
                                description: When approval was granted
                              role:
                                type: string
                                enum:
                                  - physician
                                  - nurse_practitioner
                                  - pharmacist
                                  - administrator
                                  - supervisor
                                description: Role of the approver
                              notes:
                                type: string
                                description: Approval notes or conditions
                        notes:
                          type: string
                          maxLength: 2000
                          description: Additional context or notes
                    - type: object
                      required:
                        - reason
                      properties:
                        reason:
                          examples:
                            - >-
                              Added per P&T Committee approval for depression
                              treatment protocol
                            - >-
                              New generic alternative to reduce costs while
                              maintaining efficacy
                            - >-
                              Required addition for new pediatric treatment
                              guidelines
          - name: medication.prescribed
            title: Medication Prescribed
            summary: A medication has been prescribed to a client
            contentType: application/json
            payload:
              type: object
              required:
                - stream_id
                - stream_type
                - event_type
                - event_data
                - event_metadata
              properties:
                stream_id:
                  type: string
                  format: uuid
                  description: The medication_history ID
                stream_type:
                  type: string
                  const: medication_history
                event_type:
                  type: string
                  const: medication.prescribed
                event_data:
                  type: object
                  required:
                    - organization_id
                    - client_id
                    - medication_id
                    - prescription_date
                    - start_date
                    - dosage_amount
                    - dosage_unit
                    - frequency
                    - route
                  properties:
                    organization_id:
                      type: string
                      format: uuid
                    client_id:
                      type: string
                      format: uuid
                      description: Client receiving the prescription
                    medication_id:
                      type: string
                      format: uuid
                      description: Medication being prescribed
                    prescription_date:
                      type: string
                      format: date
                      description: Date prescription was written
                    start_date:
                      type: string
                      format: date
                      description: Date to start medication
                    end_date:
                      type: string
                      format: date
                      description: Date to end medication (if known)
                    prescriber_name:
                      type: string
                      maxLength: 200
                      description: Name of prescribing provider
                    prescriber_npi:
                      type: string
                      pattern: ^\d{10}$
                      description: National Provider Identifier
                    prescriber_license:
                      type: string
                      maxLength: 50
                      description: Provider's license number
                    dosage_amount:
                      type: number
                      minimum: 0
                      description: Amount per dose
                    dosage_unit:
                      type: string
                      maxLength: 20
                      examples:
                        - mg
                        - ml
                        - units
                        - tablets
                    frequency:
                      type: string
                      maxLength: 100
                      examples:
                        - Once daily
                        - Twice daily
                        - Every 8 hours
                        - As needed
                    route:
                      type: string
                      enum:
                        - oral
                        - sublingual
                        - buccal
                        - rectal
                        - intravenous
                        - intramuscular
                        - subcutaneous
                        - transdermal
                        - inhalation
                        - nasal
                        - ophthalmic
                        - otic
                        - topical
                    instructions:
                      type: string
                      maxLength: 500
                      description: Special instructions
                    is_prn:
                      type: boolean
                      default: false
                      description: Is this an as-needed medication
                    prn_reason:
                      type: string
                      maxLength: 200
                      description: Reason for PRN use
                    refills_authorized:
                      type: integer
                      minimum: 0
                      maximum: 12
                    pharmacy_name:
                      type: string
                      maxLength: 200
                    notes:
                      type: string
                      maxLength: 2000
                event_metadata:
                  allOf:
                    - type: object
                      required:
                        - user_id
                        - reason
                      properties:
                        user_id:
                          type: string
                          format: uuid
                          description: ID of the user who initiated this event
                        reason:
                          type: string
                          minLength: 10
                          maxLength: 500
                          description: >
                            Business justification for this action. This field
                            captures the "WHY"

                            behind every change and is REQUIRED for all events.
                          examples:
                            - >-
                              Patient showed allergic reaction to previous
                              medication
                            - >-
                              Dosage adjustment per physician consultation on
                              2024-01-15
                            - >-
                              Regular intake from emergency department referral
                              #12345
                        user_email:
                          type: string
                          format: email
                          description: Email of the user who initiated this event
                        user_name:
                          type: string
                          description: Name of the user who initiated this event
                        correlation_id:
                          type: string
                          format: uuid
                          description: ID to correlate related events across the system
                        causation_id:
                          type: string
                          format: uuid
                          description: ID of the event that caused this event
                        ip_address:
                          type: string
                          format: ipv4
                          description: IP address of the client
                        user_agent:
                          type: string
                          description: User agent string of the client
                        approval_chain:
                          type: array
                          description: Chain of approvals for this action
                          items:
                            type: object
                            required:
                              - approver_id
                              - approved_at
                              - role
                            properties:
                              approver_id:
                                type: string
                                format: uuid
                                description: ID of the approver
                              approver_name:
                                type: string
                                description: Name of the approver
                              approver_email:
                                type: string
                                format: email
                              approved_at:
                                type: string
                                format: date-time
                                description: When approval was granted
                              role:
                                type: string
                                enum:
                                  - physician
                                  - nurse_practitioner
                                  - pharmacist
                                  - administrator
                                  - supervisor
                                description: Role of the approver
                              notes:
                                type: string
                                description: Approval notes or conditions
                        notes:
                          type: string
                          maxLength: 2000
                          description: Additional context or notes
                    - type: object
                      required:
                        - reason
                      properties:
                        reason:
                          examples:
                            - >-
                              Initial prescription for diagnosed major
                              depressive disorder per DSM-5 criteria
                            - >-
                              Switching from previous medication due to adverse
                              side effects reported on 2024-01-15
                            - >-
                              Dosage increase due to insufficient therapeutic
                              response after 4-week trial
                        approval_chain:
                          minItems: 1
                          description: Prescription requires at least one approval
          - name: medication.administered
            title: Medication Administered
            summary: A medication dose has been administered to a client
            contentType: application/json
            payload:
              type: object
              required:
                - stream_id
                - stream_type
                - event_type
                - event_data
                - event_metadata
              properties:
                stream_id:
                  type: string
                  format: uuid
                  description: The dosage_info ID
                stream_type:
                  type: string
                  const: dosage
                event_type:
                  type: string
                  const: medication.administered
                event_data:
                  type: object
                  required:
                    - organization_id
                    - client_id
                    - medication_history_id
                    - scheduled_datetime
                    - administered_at
                    - administered_by
                    - scheduled_amount
                    - administered_amount
                    - unit
                  properties:
                    organization_id:
                      type: string
                      format: uuid
                    client_id:
                      type: string
                      format: uuid
                    medication_history_id:
                      type: string
                      format: uuid
                      description: Reference to prescription
                    scheduled_datetime:
                      type: string
                      format: date-time
                      description: When dose was scheduled
                    administered_at:
                      type: string
                      format: date-time
                      description: Actual administration time
                    administered_by:
                      type: string
                      format: uuid
                      description: ID of administering staff
                    scheduled_amount:
                      type: number
                      minimum: 0
                    administered_amount:
                      type: number
                      minimum: 0
                      description: Actual amount given
                    unit:
                      type: string
                      maxLength: 20
                    method:
                      type: string
                      description: Administration method
                    witnessed_by:
                      type: string
                      format: uuid
                      description: Witness for controlled substances
                    vitals_before:
                      type: object
                      properties:
                        blood_pressure_systolic:
                          type: integer
                          minimum: 40
                          maximum: 300
                        blood_pressure_diastolic:
                          type: integer
                          minimum: 20
                          maximum: 200
                        heart_rate:
                          type: integer
                          minimum: 20
                          maximum: 300
                        temperature_fahrenheit:
                          type: number
                          minimum: 85
                          maximum: 115
                        respiratory_rate:
                          type: integer
                          minimum: 5
                          maximum: 60
                        oxygen_saturation:
                          type: integer
                          minimum: 50
                          maximum: 100
                        pain_scale:
                          type: integer
                          minimum: 0
                          maximum: 10
                    vitals_after:
                      type: object
                      properties:
                        blood_pressure_systolic:
                          type: integer
                          minimum: 40
                          maximum: 300
                        blood_pressure_diastolic:
                          type: integer
                          minimum: 20
                          maximum: 200
                        heart_rate:
                          type: integer
                          minimum: 20
                          maximum: 300
                        temperature_fahrenheit:
                          type: number
                          minimum: 85
                          maximum: 115
                        respiratory_rate:
                          type: integer
                          minimum: 5
                          maximum: 60
                        oxygen_saturation:
                          type: integer
                          minimum: 50
                          maximum: 100
                        pain_scale:
                          type: integer
                          minimum: 0
                          maximum: 10
                    side_effects:
                      type: array
                      items:
                        type: string
                        maxLength: 200
                    notes:
                      type: string
                      maxLength: 1000
                event_metadata:
                  allOf:
                    - type: object
                      required:
                        - user_id
                        - reason
                      properties:
                        user_id:
                          type: string
                          format: uuid
                          description: ID of the user who initiated this event
                        reason:
                          type: string
                          minLength: 10
                          maxLength: 500
                          description: >
                            Business justification for this action. This field
                            captures the "WHY"

                            behind every change and is REQUIRED for all events.
                          examples:
                            - >-
                              Patient showed allergic reaction to previous
                              medication
                            - >-
                              Dosage adjustment per physician consultation on
                              2024-01-15
                            - >-
                              Regular intake from emergency department referral
                              #12345
                        user_email:
                          type: string
                          format: email
                          description: Email of the user who initiated this event
                        user_name:
                          type: string
                          description: Name of the user who initiated this event
                        correlation_id:
                          type: string
                          format: uuid
                          description: ID to correlate related events across the system
                        causation_id:
                          type: string
                          format: uuid
                          description: ID of the event that caused this event
                        ip_address:
                          type: string
                          format: ipv4
                          description: IP address of the client
                        user_agent:
                          type: string
                          description: User agent string of the client
                        approval_chain:
                          type: array
                          description: Chain of approvals for this action
                          items:
                            type: object
                            required:
                              - approver_id
                              - approved_at
                              - role
                            properties:
                              approver_id:
                                type: string
                                format: uuid
                                description: ID of the approver
                              approver_name:
                                type: string
                                description: Name of the approver
                              approver_email:
                                type: string
                                format: email
                              approved_at:
                                type: string
                                format: date-time
                                description: When approval was granted
                              role:
                                type: string
                                enum:
                                  - physician
                                  - nurse_practitioner
                                  - pharmacist
                                  - administrator
                                  - supervisor
                                description: Role of the approver
                              notes:
                                type: string
                                description: Approval notes or conditions
                        notes:
                          type: string
                          maxLength: 2000
                          description: Additional context or notes
                    - type: object
                      required:
                        - reason
                      properties:
                        reason:
                          examples:
                            - >-
                              Scheduled morning medication administered with
                              breakfast
                            - PRN medication given for reported pain level 7/10
                            - >-
                              Emergency medication administered for acute
                              anxiety episode
          - name: medication.skipped
            title: Medication Skipped
            summary: A scheduled medication dose was skipped
            contentType: application/json
            payload:
              type: object
              required:
                - stream_id
                - stream_type
                - event_type
                - event_data
                - event_metadata
              properties:
                stream_id:
                  type: string
                  format: uuid
                stream_type:
                  type: string
                  const: dosage
                event_type:
                  type: string
                  const: medication.skipped
                event_data:
                  type: object
                  required:
                    - organization_id
                    - client_id
                    - medication_history_id
                    - scheduled_datetime
                    - skip_reason
                  properties:
                    organization_id:
                      type: string
                      format: uuid
                    client_id:
                      type: string
                      format: uuid
                    medication_history_id:
                      type: string
                      format: uuid
                    scheduled_datetime:
                      type: string
                      format: date-time
                    scheduled_amount:
                      type: number
                    unit:
                      type: string
                    skip_reason:
                      type: string
                      enum:
                        - client_absent
                        - client_npo
                        - medication_unavailable
                        - clinical_hold
                        - physician_order
                        - vital_signs_out_of_range
                        - other
                    skip_details:
                      type: string
                      maxLength: 500
                event_metadata:
                  allOf:
                    - type: object
                      required:
                        - user_id
                        - reason
                      properties:
                        user_id:
                          type: string
                          format: uuid
                          description: ID of the user who initiated this event
                        reason:
                          type: string
                          minLength: 10
                          maxLength: 500
                          description: >
                            Business justification for this action. This field
                            captures the "WHY"

                            behind every change and is REQUIRED for all events.
                          examples:
                            - >-
                              Patient showed allergic reaction to previous
                              medication
                            - >-
                              Dosage adjustment per physician consultation on
                              2024-01-15
                            - >-
                              Regular intake from emergency department referral
                              #12345
                        user_email:
                          type: string
                          format: email
                          description: Email of the user who initiated this event
                        user_name:
                          type: string
                          description: Name of the user who initiated this event
                        correlation_id:
                          type: string
                          format: uuid
                          description: ID to correlate related events across the system
                        causation_id:
                          type: string
                          format: uuid
                          description: ID of the event that caused this event
                        ip_address:
                          type: string
                          format: ipv4
                          description: IP address of the client
                        user_agent:
                          type: string
                          description: User agent string of the client
                        approval_chain:
                          type: array
                          description: Chain of approvals for this action
                          items:
                            type: object
                            required:
                              - approver_id
                              - approved_at
                              - role
                            properties:
                              approver_id:
                                type: string
                                format: uuid
                                description: ID of the approver
                              approver_name:
                                type: string
                                description: Name of the approver
                              approver_email:
                                type: string
                                format: email
                              approved_at:
                                type: string
                                format: date-time
                                description: When approval was granted
                              role:
                                type: string
                                enum:
                                  - physician
                                  - nurse_practitioner
                                  - pharmacist
                                  - administrator
                                  - supervisor
                                description: Role of the approver
                              notes:
                                type: string
                                description: Approval notes or conditions
                        notes:
                          type: string
                          maxLength: 2000
                          description: Additional context or notes
                    - type: object
                      required:
                        - reason
                      properties:
                        reason:
                          examples:
                            - Client was NPO for scheduled procedure
                            - Medication held due to low blood pressure reading
                            - Skipped per physician order due to lab results
          - name: medication.refused
            title: Medication Refused
            summary: A client refused a medication dose
            contentType: application/json
            payload:
              type: object
              required:
                - stream_id
                - stream_type
                - event_type
                - event_data
                - event_metadata
              properties:
                stream_id:
                  type: string
                  format: uuid
                stream_type:
                  type: string
                  const: dosage
                event_type:
                  type: string
                  const: medication.refused
                event_data:
                  type: object
                  required:
                    - organization_id
                    - client_id
                    - medication_history_id
                    - scheduled_datetime
                    - refusal_reason
                  properties:
                    organization_id:
                      type: string
                      format: uuid
                    client_id:
                      type: string
                      format: uuid
                    medication_history_id:
                      type: string
                      format: uuid
                    scheduled_datetime:
                      type: string
                      format: date-time
                    refusal_reason:
                      type: string
                      maxLength: 500
                    client_stated_reason:
                      type: string
                      maxLength: 500
                      description: Client's stated reason in their own words
                    education_provided:
                      type: boolean
                      description: Was education about risks provided
                    provider_notified:
                      type: boolean
                      description: Was provider notified of refusal
                    follow_up_plan:
                      type: string
                      maxLength: 1000
                event_metadata:
                  allOf:
                    - type: object
                      required:
                        - user_id
                        - reason
                      properties:
                        user_id:
                          type: string
                          format: uuid
                          description: ID of the user who initiated this event
                        reason:
                          type: string
                          minLength: 10
                          maxLength: 500
                          description: >
                            Business justification for this action. This field
                            captures the "WHY"

                            behind every change and is REQUIRED for all events.
                          examples:
                            - >-
                              Patient showed allergic reaction to previous
                              medication
                            - >-
                              Dosage adjustment per physician consultation on
                              2024-01-15
                            - >-
                              Regular intake from emergency department referral
                              #12345
                        user_email:
                          type: string
                          format: email
                          description: Email of the user who initiated this event
                        user_name:
                          type: string
                          description: Name of the user who initiated this event
                        correlation_id:
                          type: string
                          format: uuid
                          description: ID to correlate related events across the system
                        causation_id:
                          type: string
                          format: uuid
                          description: ID of the event that caused this event
                        ip_address:
                          type: string
                          format: ipv4
                          description: IP address of the client
                        user_agent:
                          type: string
                          description: User agent string of the client
                        approval_chain:
                          type: array
                          description: Chain of approvals for this action
                          items:
                            type: object
                            required:
                              - approver_id
                              - approved_at
                              - role
                            properties:
                              approver_id:
                                type: string
                                format: uuid
                                description: ID of the approver
                              approver_name:
                                type: string
                                description: Name of the approver
                              approver_email:
                                type: string
                                format: email
                              approved_at:
                                type: string
                                format: date-time
                                description: When approval was granted
                              role:
                                type: string
                                enum:
                                  - physician
                                  - nurse_practitioner
                                  - pharmacist
                                  - administrator
                                  - supervisor
                                description: Role of the approver
                              notes:
                                type: string
                                description: Approval notes or conditions
                        notes:
                          type: string
                          maxLength: 2000
                          description: Additional context or notes
                    - type: object
                      required:
                        - reason
                      properties:
                        reason:
                          examples:
                            - Client exercised right to refuse medication
                            - Client reported severe nausea from previous dose
                            - >-
                              Client wants to discuss with family before
                              continuing
          - name: medication.discontinued
            title: Medication Discontinued
            summary: A medication prescription has been discontinued
            contentType: application/json
            payload:
              type: object
              required:
                - stream_id
                - stream_type
                - event_type
                - event_data
                - event_metadata
              properties:
                stream_id:
                  type: string
                  format: uuid
                stream_type:
                  type: string
                  const: medication_history
                event_type:
                  type: string
                  const: medication.discontinued
                event_data:
                  type: object
                  required:
                    - medication_history_id
                    - discontinue_date
                    - discontinue_reason_category
                  properties:
                    medication_history_id:
                      type: string
                      format: uuid
                    discontinue_date:
                      type: string
                      format: date
                    discontinue_reason_category:
                      type: string
                      enum:
                        - adverse_reaction
                        - ineffective
                        - client_request
                        - treatment_complete
                        - cost
                        - drug_interaction
                        - contraindication
                        - other
                    discontinue_details:
                      type: string
                      maxLength: 2000
                    adverse_events:
                      type: array
                      items:
                        type: string
                        maxLength: 500
                    alternative_medication:
                      type: string
                      maxLength: 200
                      description: Alternative medication if switching
                    tapering_schedule:
                      type: string
                      maxLength: 1000
                      description: Tapering instructions if applicable
                event_metadata:
                  allOf:
                    - type: object
                      required:
                        - user_id
                        - reason
                      properties:
                        user_id:
                          type: string
                          format: uuid
                          description: ID of the user who initiated this event
                        reason:
                          type: string
                          minLength: 10
                          maxLength: 500
                          description: >
                            Business justification for this action. This field
                            captures the "WHY"

                            behind every change and is REQUIRED for all events.
                          examples:
                            - >-
                              Patient showed allergic reaction to previous
                              medication
                            - >-
                              Dosage adjustment per physician consultation on
                              2024-01-15
                            - >-
                              Regular intake from emergency department referral
                              #12345
                        user_email:
                          type: string
                          format: email
                          description: Email of the user who initiated this event
                        user_name:
                          type: string
                          description: Name of the user who initiated this event
                        correlation_id:
                          type: string
                          format: uuid
                          description: ID to correlate related events across the system
                        causation_id:
                          type: string
                          format: uuid
                          description: ID of the event that caused this event
                        ip_address:
                          type: string
                          format: ipv4
                          description: IP address of the client
                        user_agent:
                          type: string
                          description: User agent string of the client
                        approval_chain:
                          type: array
                          description: Chain of approvals for this action
                          items:
                            type: object
                            required:
                              - approver_id
                              - approved_at
                              - role
                            properties:
                              approver_id:
                                type: string
                                format: uuid
                                description: ID of the approver
                              approver_name:
                                type: string
                                description: Name of the approver
                              approver_email:
                                type: string
                                format: email
                              approved_at:
                                type: string
                                format: date-time
                                description: When approval was granted
                              role:
                                type: string
                                enum:
                                  - physician
                                  - nurse_practitioner
                                  - pharmacist
                                  - administrator
                                  - supervisor
                                description: Role of the approver
                              notes:
                                type: string
                                description: Approval notes or conditions
                        notes:
                          type: string
                          maxLength: 2000
                          description: Additional context or notes
                    - type: object
                      required:
                        - reason
                      properties:
                        reason:
                          examples:
                            - >-
                              Discontinued due to severe allergic reaction
                              requiring emergency intervention
                            - >-
                              Treatment completed successfully, medication no
                              longer needed
                            - >-
                              Switching to alternative medication for better
                              efficacy
                            - >-
                              Discontinued per client request after informed
                              consent discussion
          - name: user.synced_from_zitadel
            title: User Synced from Zitadel
            summary: User information synchronized from Zitadel identity provider
            contentType: application/json
            payload:
              type: object
              required:
                - stream_id
                - stream_type
                - event_type
                - event_data
                - event_metadata
              properties:
                stream_id:
                  type: string
                  format: uuid
                stream_type:
                  type: string
                  const: user
                event_type:
                  type: string
                  const: user.synced_from_zitadel
                event_data:
                  type: object
                  required:
                    - external_id
                    - email
                    - roles
                  properties:
                    external_id:
                      type: string
                      description: Zitadel User ID
                    email:
                      type: string
                      format: email
                    name:
                      type: string
                    roles:
                      type: array
                      items:
                        type: string
                        enum:
                          - super_admin
                          - administrator
                          - clinician
                          - specialist
                          - parent
                          - youth
                    accessible_organizations:
                      type: array
                      items:
                        type: string
                        format: uuid
                event_metadata:
                  allOf:
                    - type: object
                      required:
                        - user_id
                        - reason
                      properties:
                        user_id:
                          type: string
                          format: uuid
                          description: ID of the user who initiated this event
                        reason:
                          type: string
                          minLength: 10
                          maxLength: 500
                          description: >
                            Business justification for this action. This field
                            captures the "WHY"

                            behind every change and is REQUIRED for all events.
                          examples:
                            - >-
                              Patient showed allergic reaction to previous
                              medication
                            - >-
                              Dosage adjustment per physician consultation on
                              2024-01-15
                            - >-
                              Regular intake from emergency department referral
                              #12345
                        user_email:
                          type: string
                          format: email
                          description: Email of the user who initiated this event
                        user_name:
                          type: string
                          description: Name of the user who initiated this event
                        correlation_id:
                          type: string
                          format: uuid
                          description: ID to correlate related events across the system
                        causation_id:
                          type: string
                          format: uuid
                          description: ID of the event that caused this event
                        ip_address:
                          type: string
                          format: ipv4
                          description: IP address of the client
                        user_agent:
                          type: string
                          description: User agent string of the client
                        approval_chain:
                          type: array
                          description: Chain of approvals for this action
                          items:
                            type: object
                            required:
                              - approver_id
                              - approved_at
                              - role
                            properties:
                              approver_id:
                                type: string
                                format: uuid
                                description: ID of the approver
                              approver_name:
                                type: string
                                description: Name of the approver
                              approver_email:
                                type: string
                                format: email
                              approved_at:
                                type: string
                                format: date-time
                                description: When approval was granted
                              role:
                                type: string
                                enum:
                                  - physician
                                  - nurse_practitioner
                                  - pharmacist
                                  - administrator
                                  - supervisor
                                description: Role of the approver
                              notes:
                                type: string
                                description: Approval notes or conditions
                        notes:
                          type: string
                          maxLength: 2000
                          description: Additional context or notes
                    - properties:
                        reason:
                          examples:
                            - Initial user sync after Zitadel registration
                            - Role update sync after admin promotion
                            - Periodic sync to ensure consistency
          - name: user.organization_switched
            title: User Organization Switched
            summary: User switched their active organization context
            contentType: application/json
            payload:
              type: object
              required:
                - stream_id
                - stream_type
                - event_type
                - event_data
                - event_metadata
              properties:
                stream_id:
                  type: string
                  format: uuid
                stream_type:
                  type: string
                  const: user
                event_type:
                  type: string
                  const: user.organization_switched
                event_data:
                  type: object
                  required:
                    - user_id
                    - from_organization_id
                    - to_organization_id
                  properties:
                    user_id:
                      type: string
                      format: uuid
                    from_organization_id:
                      type: string
                      format: uuid
                      nullable: true
                    to_organization_id:
                      type: string
                      format: uuid
                event_metadata:
                  allOf:
                    - type: object
                      required:
                        - user_id
                        - reason
                      properties:
                        user_id:
                          type: string
                          format: uuid
                          description: ID of the user who initiated this event
                        reason:
                          type: string
                          minLength: 10
                          maxLength: 500
                          description: >
                            Business justification for this action. This field
                            captures the "WHY"

                            behind every change and is REQUIRED for all events.
                          examples:
                            - >-
                              Patient showed allergic reaction to previous
                              medication
                            - >-
                              Dosage adjustment per physician consultation on
                              2024-01-15
                            - >-
                              Regular intake from emergency department referral
                              #12345
                        user_email:
                          type: string
                          format: email
                          description: Email of the user who initiated this event
                        user_name:
                          type: string
                          description: Name of the user who initiated this event
                        correlation_id:
                          type: string
                          format: uuid
                          description: ID to correlate related events across the system
                        causation_id:
                          type: string
                          format: uuid
                          description: ID of the event that caused this event
                        ip_address:
                          type: string
                          format: ipv4
                          description: IP address of the client
                        user_agent:
                          type: string
                          description: User agent string of the client
                        approval_chain:
                          type: array
                          description: Chain of approvals for this action
                          items:
                            type: object
                            required:
                              - approver_id
                              - approved_at
                              - role
                            properties:
                              approver_id:
                                type: string
                                format: uuid
                                description: ID of the approver
                              approver_name:
                                type: string
                                description: Name of the approver
                              approver_email:
                                type: string
                                format: email
                              approved_at:
                                type: string
                                format: date-time
                                description: When approval was granted
                              role:
                                type: string
                                enum:
                                  - physician
                                  - nurse_practitioner
                                  - pharmacist
                                  - administrator
                                  - supervisor
                                description: Role of the approver
                              notes:
                                type: string
                                description: Approval notes or conditions
                        notes:
                          type: string
                          maxLength: 2000
                          description: Additional context or notes
                    - properties:
                        reason:
                          examples:
                            - User selected different organization from dropdown
                            - Automatic switch after single org access granted
                            - Session initialization with default organization
    subscribe:
      summary: Subscribe to domain events
      operationId: onDomainEvent
      message:
        oneOf:
          - name: client.registered
            title: Client Registered
            summary: A new client has been registered in the system
            contentType: application/json
            payload:
              type: object
              required:
                - stream_id
                - stream_type
                - event_type
                - event_data
                - event_metadata
              properties:
                stream_id:
                  type: string
                  format: uuid
                  description: The client ID
                stream_type:
                  type: string
                  const: client
                event_type:
                  type: string
                  const: client.registered
                event_data:
                  type: object
                  required:
                    - organization_id
                    - first_name
                    - last_name
                    - date_of_birth
                  properties:
                    organization_id:
                      type: string
                      format: uuid
                      description: Organization this client belongs to
                    first_name:
                      type: string
                      minLength: 1
                      maxLength: 100
                      pattern: ^[a-zA-Z\s\-'\.]+$
                      description: Client's legal first name
                    last_name:
                      type: string
                      minLength: 1
                      maxLength: 100
                      pattern: ^[a-zA-Z\s\-'\.]+$
                      description: Client's legal last name
                    date_of_birth:
                      type: string
                      format: date
                      description: Client's date of birth (YYYY-MM-DD)
                    gender:
                      type: string
                      enum:
                        - male
                        - female
                        - other
                        - prefer_not_to_say
                      description: Client's gender identity
                    email:
                      type: string
                      format: email
                      maxLength: 255
                      description: Client's email address
                    phone:
                      type: string
                      pattern: ^\+?1?\d{10,14}$
                      description: Client's primary phone number
                    address:
                      type: object
                      properties:
                        street:
                          type: string
                          maxLength: 200
                        city:
                          type: string
                          maxLength: 100
                        state:
                          type: string
                          maxLength: 2
                          pattern: ^[A-Z]{2}$
                        zip_code:
                          type: string
                          pattern: ^\d{5}(-\d{4})?$
                        country:
                          type: string
                          default: USA
                          maxLength: 100
                    emergency_contact:
                      type: object
                      required:
                        - name
                        - relationship
                        - phone
                      properties:
                        name:
                          type: string
                          maxLength: 200
                        relationship:
                          type: string
                          enum:
                            - parent
                            - guardian
                            - spouse
                            - sibling
                            - child
                            - friend
                            - other
                        phone:
                          type: string
                          pattern: ^\+?1?\d{10,14}$
                        alternate_phone:
                          type: string
                          pattern: ^\+?1?\d{10,14}$
                        email:
                          type: string
                          format: email
                    allergies:
                      type: array
                      description: Known allergies
                      items:
                        type: string
                        maxLength: 200
                    medical_conditions:
                      type: array
                      description: Pre-existing medical conditions
                      items:
                        type: string
                        maxLength: 200
                    blood_type:
                      type: string
                      enum:
                        - A+
                        - A-
                        - B+
                        - B-
                        - AB+
                        - AB-
                        - O+
                        - O-
                      description: Client's blood type
                    insurance_provider:
                      type: string
                      maxLength: 200
                      description: Primary insurance provider
                    insurance_policy_number:
                      type: string
                      maxLength: 100
                      description: Insurance policy number
                    notes:
                      type: string
                      maxLength: 2000
                      description: Additional registration notes
                event_metadata:
                  allOf:
                    - type: object
                      required:
                        - user_id
                        - reason
                      properties:
                        user_id:
                          type: string
                          format: uuid
                          description: ID of the user who initiated this event
                        reason:
                          type: string
                          minLength: 10
                          maxLength: 500
                          description: >
                            Business justification for this action. This field
                            captures the "WHY"

                            behind every change and is REQUIRED for all events.
                          examples:
                            - >-
                              Patient showed allergic reaction to previous
                              medication
                            - >-
                              Dosage adjustment per physician consultation on
                              2024-01-15
                            - >-
                              Regular intake from emergency department referral
                              #12345
                        user_email:
                          type: string
                          format: email
                          description: Email of the user who initiated this event
                        user_name:
                          type: string
                          description: Name of the user who initiated this event
                        correlation_id:
                          type: string
                          format: uuid
                          description: ID to correlate related events across the system
                        causation_id:
                          type: string
                          format: uuid
                          description: ID of the event that caused this event
                        ip_address:
                          type: string
                          format: ipv4
                          description: IP address of the client
                        user_agent:
                          type: string
                          description: User agent string of the client
                        approval_chain:
                          type: array
                          description: Chain of approvals for this action
                          items:
                            type: object
                            required:
                              - approver_id
                              - approved_at
                              - role
                            properties:
                              approver_id:
                                type: string
                                format: uuid
                                description: ID of the approver
                              approver_name:
                                type: string
                                description: Name of the approver
                              approver_email:
                                type: string
                                format: email
                              approved_at:
                                type: string
                                format: date-time
                                description: When approval was granted
                              role:
                                type: string
                                enum:
                                  - physician
                                  - nurse_practitioner
                                  - pharmacist
                                  - administrator
                                  - supervisor
                                description: Role of the approver
                              notes:
                                type: string
                                description: Approval notes or conditions
                        notes:
                          type: string
                          maxLength: 2000
                          description: Additional context or notes
                    - type: object
                      required:
                        - reason
                      properties:
                        reason:
                          examples:
                            - >-
                              Initial intake from emergency department referral
                              #12345
                            - >-
                              Transfer from pediatric unit per Dr. Smith's
                              discharge summary
                            - >-
                              New admission for outpatient therapy program
                              starting 2024-02-01
          - name: client.admitted
            title: Client Admitted
            summary: A client has been admitted to a facility
            contentType: application/json
            payload:
              type: object
              required:
                - stream_id
                - stream_type
                - event_type
                - event_data
                - event_metadata
              properties:
                stream_id:
                  type: string
                  format: uuid
                stream_type:
                  type: string
                  const: client
                event_type:
                  type: string
                  const: client.admitted
                event_data:
                  type: object
                  required:
                    - admission_date
                    - facility_id
                    - admission_type
                  properties:
                    admission_date:
                      type: string
                      format: date
                      description: Date of admission
                    facility_id:
                      type: string
                      format: uuid
                      description: Facility where client is admitted
                    admission_type:
                      type: string
                      enum:
                        - scheduled
                        - emergency
                        - transfer
                        - readmission
                      description: Type of admission
                    referring_provider:
                      type: string
                      maxLength: 200
                      description: Name of referring provider
                    referring_organization:
                      type: string
                      maxLength: 200
                      description: Referring organization
                    primary_diagnosis:
                      type: string
                      maxLength: 500
                      description: Primary diagnosis or reason for admission
                    secondary_diagnoses:
                      type: array
                      items:
                        type: string
                        maxLength: 500
                    expected_length_of_stay:
                      type: integer
                      minimum: 1
                      maximum: 365
                      description: Expected length of stay in days
                    admission_notes:
                      type: string
                      maxLength: 5000
                event_metadata:
                  allOf:
                    - type: object
                      required:
                        - user_id
                        - reason
                      properties:
                        user_id:
                          type: string
                          format: uuid
                          description: ID of the user who initiated this event
                        reason:
                          type: string
                          minLength: 10
                          maxLength: 500
                          description: >
                            Business justification for this action. This field
                            captures the "WHY"

                            behind every change and is REQUIRED for all events.
                          examples:
                            - >-
                              Patient showed allergic reaction to previous
                              medication
                            - >-
                              Dosage adjustment per physician consultation on
                              2024-01-15
                            - >-
                              Regular intake from emergency department referral
                              #12345
                        user_email:
                          type: string
                          format: email
                          description: Email of the user who initiated this event
                        user_name:
                          type: string
                          description: Name of the user who initiated this event
                        correlation_id:
                          type: string
                          format: uuid
                          description: ID to correlate related events across the system
                        causation_id:
                          type: string
                          format: uuid
                          description: ID of the event that caused this event
                        ip_address:
                          type: string
                          format: ipv4
                          description: IP address of the client
                        user_agent:
                          type: string
                          description: User agent string of the client
                        approval_chain:
                          type: array
                          description: Chain of approvals for this action
                          items:
                            type: object
                            required:
                              - approver_id
                              - approved_at
                              - role
                            properties:
                              approver_id:
                                type: string
                                format: uuid
                                description: ID of the approver
                              approver_name:
                                type: string
                                description: Name of the approver
                              approver_email:
                                type: string
                                format: email
                              approved_at:
                                type: string
                                format: date-time
                                description: When approval was granted
                              role:
                                type: string
                                enum:
                                  - physician
                                  - nurse_practitioner
                                  - pharmacist
                                  - administrator
                                  - supervisor
                                description: Role of the approver
                              notes:
                                type: string
                                description: Approval notes or conditions
                        notes:
                          type: string
                          maxLength: 2000
                          description: Additional context or notes
                    - type: object
                      required:
                        - reason
                      properties:
                        reason:
                          examples:
                            - >-
                              Scheduled admission for substance abuse treatment
                              program
                            - >-
                              Emergency admission due to mental health crisis
                              per court order #2024-123
                            - >-
                              Routine admission for medication stabilization and
                              monitoring
          - name: client.information_updated
            title: Client Information Updated
            summary: Client information has been modified
            contentType: application/json
            payload:
              type: object
              required:
                - stream_id
                - stream_type
                - event_type
                - event_data
                - event_metadata
              properties:
                stream_id:
                  type: string
                  format: uuid
                stream_type:
                  type: string
                  const: client
                event_type:
                  type: string
                  const: client.information_updated
                event_data:
                  type: object
                  required:
                    - changes
                  properties:
                    changes:
                      type: object
                      description: Fields that were changed (only include changed fields)
                      properties:
                        first_name:
                          type: string
                        last_name:
                          type: string
                        email:
                          type: string
                          format: email
                        phone:
                          type: string
                        address:
                          type: object
                          properties:
                            street:
                              type: string
                              maxLength: 200
                            city:
                              type: string
                              maxLength: 100
                            state:
                              type: string
                              maxLength: 2
                              pattern: ^[A-Z]{2}$
                            zip_code:
                              type: string
                              pattern: ^\d{5}(-\d{4})?$
                            country:
                              type: string
                              default: USA
                              maxLength: 100
                        emergency_contact:
                          type: object
                          required:
                            - name
                            - relationship
                            - phone
                          properties:
                            name:
                              type: string
                              maxLength: 200
                            relationship:
                              type: string
                              enum:
                                - parent
                                - guardian
                                - spouse
                                - sibling
                                - child
                                - friend
                                - other
                            phone:
                              type: string
                              pattern: ^\+?1?\d{10,14}$
                            alternate_phone:
                              type: string
                              pattern: ^\+?1?\d{10,14}$
                            email:
                              type: string
                              format: email
                        allergies:
                          type: array
                          items:
                            type: string
                        medical_conditions:
                          type: array
                          items:
                            type: string
                        blood_type:
                          type: string
                        insurance_provider:
                          type: string
                        insurance_policy_number:
                          type: string
                        notes:
                          type: string
                    previous_values:
                      type: object
                      description: Previous values of changed fields (for audit trail)
                event_metadata:
                  allOf:
                    - type: object
                      required:
                        - user_id
                        - reason
                      properties:
                        user_id:
                          type: string
                          format: uuid
                          description: ID of the user who initiated this event
                        reason:
                          type: string
                          minLength: 10
                          maxLength: 500
                          description: >
                            Business justification for this action. This field
                            captures the "WHY"

                            behind every change and is REQUIRED for all events.
                          examples:
                            - >-
                              Patient showed allergic reaction to previous
                              medication
                            - >-
                              Dosage adjustment per physician consultation on
                              2024-01-15
                            - >-
                              Regular intake from emergency department referral
                              #12345
                        user_email:
                          type: string
                          format: email
                          description: Email of the user who initiated this event
                        user_name:
                          type: string
                          description: Name of the user who initiated this event
                        correlation_id:
                          type: string
                          format: uuid
                          description: ID to correlate related events across the system
                        causation_id:
                          type: string
                          format: uuid
                          description: ID of the event that caused this event
                        ip_address:
                          type: string
                          format: ipv4
                          description: IP address of the client
                        user_agent:
                          type: string
                          description: User agent string of the client
                        approval_chain:
                          type: array
                          description: Chain of approvals for this action
                          items:
                            type: object
                            required:
                              - approver_id
                              - approved_at
                              - role
                            properties:
                              approver_id:
                                type: string
                                format: uuid
                                description: ID of the approver
                              approver_name:
                                type: string
                                description: Name of the approver
                              approver_email:
                                type: string
                                format: email
                              approved_at:
                                type: string
                                format: date-time
                                description: When approval was granted
                              role:
                                type: string
                                enum:
                                  - physician
                                  - nurse_practitioner
                                  - pharmacist
                                  - administrator
                                  - supervisor
                                description: Role of the approver
                              notes:
                                type: string
                                description: Approval notes or conditions
                        notes:
                          type: string
                          maxLength: 2000
                          description: Additional context or notes
                    - type: object
                      required:
                        - reason
                      properties:
                        reason:
                          examples:
                            - >-
                              Updated emergency contact per client's request
                              during intake
                            - >-
                              Corrected date of birth based on verified
                              government ID
                            - >-
                              Added new allergy discovered during medication
                              administration
                            - >-
                              Updated address after client relocation
                              notification
          - name: client.discharged
            title: Client Discharged
            summary: A client has been discharged from a facility
            contentType: application/json
            payload:
              type: object
              required:
                - stream_id
                - stream_type
                - event_type
                - event_data
                - event_metadata
              properties:
                stream_id:
                  type: string
                  format: uuid
                stream_type:
                  type: string
                  const: client
                event_type:
                  type: string
                  const: client.discharged
                event_data:
                  type: object
                  required:
                    - discharge_date
                    - discharge_type
                    - discharge_disposition
                  properties:
                    discharge_date:
                      type: string
                      format: date
                      description: Date of discharge
                    discharge_type:
                      type: string
                      enum:
                        - planned
                        - against_medical_advice
                        - transfer
                        - administrative
                        - death
                      description: Type of discharge
                    discharge_disposition:
                      type: string
                      enum:
                        - home
                        - home_with_services
                        - skilled_nursing_facility
                        - rehabilitation_facility
                        - acute_care_hospital
                        - psychiatric_hospital
                        - hospice
                        - deceased
                        - left_against_advice
                        - other
                      description: Where client went after discharge
                    follow_up_appointments:
                      type: array
                      items:
                        type: object
                        properties:
                          provider:
                            type: string
                          date:
                            type: string
                            format: date
                          type:
                            type: string
                    discharge_medications:
                      type: array
                      description: Medications at discharge
                      items:
                        type: string
                    discharge_instructions:
                      type: string
                      maxLength: 5000
                      description: Instructions given to client/family
                    discharge_summary:
                      type: string
                      maxLength: 10000
                      description: Clinical discharge summary
                event_metadata:
                  allOf:
                    - type: object
                      required:
                        - user_id
                        - reason
                      properties:
                        user_id:
                          type: string
                          format: uuid
                          description: ID of the user who initiated this event
                        reason:
                          type: string
                          minLength: 10
                          maxLength: 500
                          description: >
                            Business justification for this action. This field
                            captures the "WHY"

                            behind every change and is REQUIRED for all events.
                          examples:
                            - >-
                              Patient showed allergic reaction to previous
                              medication
                            - >-
                              Dosage adjustment per physician consultation on
                              2024-01-15
                            - >-
                              Regular intake from emergency department referral
                              #12345
                        user_email:
                          type: string
                          format: email
                          description: Email of the user who initiated this event
                        user_name:
                          type: string
                          description: Name of the user who initiated this event
                        correlation_id:
                          type: string
                          format: uuid
                          description: ID to correlate related events across the system
                        causation_id:
                          type: string
                          format: uuid
                          description: ID of the event that caused this event
                        ip_address:
                          type: string
                          format: ipv4
                          description: IP address of the client
                        user_agent:
                          type: string
                          description: User agent string of the client
                        approval_chain:
                          type: array
                          description: Chain of approvals for this action
                          items:
                            type: object
                            required:
                              - approver_id
                              - approved_at
                              - role
                            properties:
                              approver_id:
                                type: string
                                format: uuid
                                description: ID of the approver
                              approver_name:
                                type: string
                                description: Name of the approver
                              approver_email:
                                type: string
                                format: email
                              approved_at:
                                type: string
                                format: date-time
                                description: When approval was granted
                              role:
                                type: string
                                enum:
                                  - physician
                                  - nurse_practitioner
                                  - pharmacist
                                  - administrator
                                  - supervisor
                                description: Role of the approver
                              notes:
                                type: string
                                description: Approval notes or conditions
                        notes:
                          type: string
                          maxLength: 2000
                          description: Additional context or notes
                    - type: object
                      required:
                        - reason
                      properties:
                        reason:
                          examples:
                            - Treatment completed successfully, goals achieved
                            - >-
                              Discharged against medical advice per client
                              request
                            - >-
                              Transfer to higher level of care at regional
                              facility
                            - >-
                              Insurance coverage exhausted, transitioning to
                              outpatient
          - name: medication.added_to_formulary
            title: Medication Added to Formulary
            summary: A new medication has been added to the organization's formulary
            contentType: application/json
            payload:
              type: object
              required:
                - stream_id
                - stream_type
                - event_type
                - event_data
                - event_metadata
              properties:
                stream_id:
                  type: string
                  format: uuid
                  description: The medication ID
                stream_type:
                  type: string
                  const: medication
                event_type:
                  type: string
                  const: medication.added_to_formulary
                event_data:
                  type: object
                  required:
                    - organization_id
                    - name
                    - generic_name
                  properties:
                    organization_id:
                      type: string
                      format: uuid
                    name:
                      type: string
                      minLength: 1
                      maxLength: 200
                      description: Medication brand name
                    generic_name:
                      type: string
                      minLength: 1
                      maxLength: 200
                      description: Generic name
                    brand_names:
                      type: array
                      items:
                        type: string
                    rxnorm_cui:
                      type: string
                      pattern: ^\d+$
                      description: RXNorm Concept Unique Identifier
                    ndc_codes:
                      type: array
                      description: National Drug Codes
                      items:
                        type: string
                        pattern: ^\d{5}-\d{4}-\d{2}$
                    category_broad:
                      type: string
                      maxLength: 100
                      examples:
                        - Psychotropic
                        - Cardiovascular
                        - Antibiotic
                    category_specific:
                      type: string
                      maxLength: 100
                      examples:
                        - Antidepressant
                        - Beta Blocker
                        - Penicillin
                    drug_class:
                      type: string
                      maxLength: 100
                    is_psychotropic:
                      type: boolean
                      default: false
                    is_controlled:
                      type: boolean
                      default: false
                    controlled_substance_schedule:
                      type: string
                      enum:
                        - Schedule I
                        - Schedule II
                        - Schedule III
                        - Schedule IV
                        - Schedule V
                    is_narcotic:
                      type: boolean
                      default: false
                    requires_monitoring:
                      type: boolean
                      default: false
                    is_high_alert:
                      type: boolean
                      default: false
                    active_ingredients:
                      type: array
                      items:
                        type: object
                        properties:
                          name:
                            type: string
                          strength:
                            type: number
                          unit:
                            type: string
                    available_forms:
                      type: array
                      items:
                        type: string
                        enum:
                          - tablet
                          - capsule
                          - liquid
                          - injection
                          - patch
                          - cream
                          - ointment
                          - inhaler
                          - suppository
                    available_strengths:
                      type: array
                      items:
                        type: string
                    manufacturer:
                      type: string
                      maxLength: 200
                    warnings:
                      type: array
                      items:
                        type: string
                    black_box_warning:
                      type: string
                      maxLength: 2000
                event_metadata:
                  allOf:
                    - type: object
                      required:
                        - user_id
                        - reason
                      properties:
                        user_id:
                          type: string
                          format: uuid
                          description: ID of the user who initiated this event
                        reason:
                          type: string
                          minLength: 10
                          maxLength: 500
                          description: >
                            Business justification for this action. This field
                            captures the "WHY"

                            behind every change and is REQUIRED for all events.
                          examples:
                            - >-
                              Patient showed allergic reaction to previous
                              medication
                            - >-
                              Dosage adjustment per physician consultation on
                              2024-01-15
                            - >-
                              Regular intake from emergency department referral
                              #12345
                        user_email:
                          type: string
                          format: email
                          description: Email of the user who initiated this event
                        user_name:
                          type: string
                          description: Name of the user who initiated this event
                        correlation_id:
                          type: string
                          format: uuid
                          description: ID to correlate related events across the system
                        causation_id:
                          type: string
                          format: uuid
                          description: ID of the event that caused this event
                        ip_address:
                          type: string
                          format: ipv4
                          description: IP address of the client
                        user_agent:
                          type: string
                          description: User agent string of the client
                        approval_chain:
                          type: array
                          description: Chain of approvals for this action
                          items:
                            type: object
                            required:
                              - approver_id
                              - approved_at
                              - role
                            properties:
                              approver_id:
                                type: string
                                format: uuid
                                description: ID of the approver
                              approver_name:
                                type: string
                                description: Name of the approver
                              approver_email:
                                type: string
                                format: email
                              approved_at:
                                type: string
                                format: date-time
                                description: When approval was granted
                              role:
                                type: string
                                enum:
                                  - physician
                                  - nurse_practitioner
                                  - pharmacist
                                  - administrator
                                  - supervisor
                                description: Role of the approver
                              notes:
                                type: string
                                description: Approval notes or conditions
                        notes:
                          type: string
                          maxLength: 2000
                          description: Additional context or notes
                    - type: object
                      required:
                        - reason
                      properties:
                        reason:
                          examples:
                            - >-
                              Added per P&T Committee approval for depression
                              treatment protocol
                            - >-
                              New generic alternative to reduce costs while
                              maintaining efficacy
                            - >-
                              Required addition for new pediatric treatment
                              guidelines
          - name: medication.prescribed
            title: Medication Prescribed
            summary: A medication has been prescribed to a client
            contentType: application/json
            payload:
              type: object
              required:
                - stream_id
                - stream_type
                - event_type
                - event_data
                - event_metadata
              properties:
                stream_id:
                  type: string
                  format: uuid
                  description: The medication_history ID
                stream_type:
                  type: string
                  const: medication_history
                event_type:
                  type: string
                  const: medication.prescribed
                event_data:
                  type: object
                  required:
                    - organization_id
                    - client_id
                    - medication_id
                    - prescription_date
                    - start_date
                    - dosage_amount
                    - dosage_unit
                    - frequency
                    - route
                  properties:
                    organization_id:
                      type: string
                      format: uuid
                    client_id:
                      type: string
                      format: uuid
                      description: Client receiving the prescription
                    medication_id:
                      type: string
                      format: uuid
                      description: Medication being prescribed
                    prescription_date:
                      type: string
                      format: date
                      description: Date prescription was written
                    start_date:
                      type: string
                      format: date
                      description: Date to start medication
                    end_date:
                      type: string
                      format: date
                      description: Date to end medication (if known)
                    prescriber_name:
                      type: string
                      maxLength: 200
                      description: Name of prescribing provider
                    prescriber_npi:
                      type: string
                      pattern: ^\d{10}$
                      description: National Provider Identifier
                    prescriber_license:
                      type: string
                      maxLength: 50
                      description: Provider's license number
                    dosage_amount:
                      type: number
                      minimum: 0
                      description: Amount per dose
                    dosage_unit:
                      type: string
                      maxLength: 20
                      examples:
                        - mg
                        - ml
                        - units
                        - tablets
                    frequency:
                      type: string
                      maxLength: 100
                      examples:
                        - Once daily
                        - Twice daily
                        - Every 8 hours
                        - As needed
                    route:
                      type: string
                      enum:
                        - oral
                        - sublingual
                        - buccal
                        - rectal
                        - intravenous
                        - intramuscular
                        - subcutaneous
                        - transdermal
                        - inhalation
                        - nasal
                        - ophthalmic
                        - otic
                        - topical
                    instructions:
                      type: string
                      maxLength: 500
                      description: Special instructions
                    is_prn:
                      type: boolean
                      default: false
                      description: Is this an as-needed medication
                    prn_reason:
                      type: string
                      maxLength: 200
                      description: Reason for PRN use
                    refills_authorized:
                      type: integer
                      minimum: 0
                      maximum: 12
                    pharmacy_name:
                      type: string
                      maxLength: 200
                    notes:
                      type: string
                      maxLength: 2000
                event_metadata:
                  allOf:
                    - type: object
                      required:
                        - user_id
                        - reason
                      properties:
                        user_id:
                          type: string
                          format: uuid
                          description: ID of the user who initiated this event
                        reason:
                          type: string
                          minLength: 10
                          maxLength: 500
                          description: >
                            Business justification for this action. This field
                            captures the "WHY"

                            behind every change and is REQUIRED for all events.
                          examples:
                            - >-
                              Patient showed allergic reaction to previous
                              medication
                            - >-
                              Dosage adjustment per physician consultation on
                              2024-01-15
                            - >-
                              Regular intake from emergency department referral
                              #12345
                        user_email:
                          type: string
                          format: email
                          description: Email of the user who initiated this event
                        user_name:
                          type: string
                          description: Name of the user who initiated this event
                        correlation_id:
                          type: string
                          format: uuid
                          description: ID to correlate related events across the system
                        causation_id:
                          type: string
                          format: uuid
                          description: ID of the event that caused this event
                        ip_address:
                          type: string
                          format: ipv4
                          description: IP address of the client
                        user_agent:
                          type: string
                          description: User agent string of the client
                        approval_chain:
                          type: array
                          description: Chain of approvals for this action
                          items:
                            type: object
                            required:
                              - approver_id
                              - approved_at
                              - role
                            properties:
                              approver_id:
                                type: string
                                format: uuid
                                description: ID of the approver
                              approver_name:
                                type: string
                                description: Name of the approver
                              approver_email:
                                type: string
                                format: email
                              approved_at:
                                type: string
                                format: date-time
                                description: When approval was granted
                              role:
                                type: string
                                enum:
                                  - physician
                                  - nurse_practitioner
                                  - pharmacist
                                  - administrator
                                  - supervisor
                                description: Role of the approver
                              notes:
                                type: string
                                description: Approval notes or conditions
                        notes:
                          type: string
                          maxLength: 2000
                          description: Additional context or notes
                    - type: object
                      required:
                        - reason
                      properties:
                        reason:
                          examples:
                            - >-
                              Initial prescription for diagnosed major
                              depressive disorder per DSM-5 criteria
                            - >-
                              Switching from previous medication due to adverse
                              side effects reported on 2024-01-15
                            - >-
                              Dosage increase due to insufficient therapeutic
                              response after 4-week trial
                        approval_chain:
                          minItems: 1
                          description: Prescription requires at least one approval
          - name: medication.administered
            title: Medication Administered
            summary: A medication dose has been administered to a client
            contentType: application/json
            payload:
              type: object
              required:
                - stream_id
                - stream_type
                - event_type
                - event_data
                - event_metadata
              properties:
                stream_id:
                  type: string
                  format: uuid
                  description: The dosage_info ID
                stream_type:
                  type: string
                  const: dosage
                event_type:
                  type: string
                  const: medication.administered
                event_data:
                  type: object
                  required:
                    - organization_id
                    - client_id
                    - medication_history_id
                    - scheduled_datetime
                    - administered_at
                    - administered_by
                    - scheduled_amount
                    - administered_amount
                    - unit
                  properties:
                    organization_id:
                      type: string
                      format: uuid
                    client_id:
                      type: string
                      format: uuid
                    medication_history_id:
                      type: string
                      format: uuid
                      description: Reference to prescription
                    scheduled_datetime:
                      type: string
                      format: date-time
                      description: When dose was scheduled
                    administered_at:
                      type: string
                      format: date-time
                      description: Actual administration time
                    administered_by:
                      type: string
                      format: uuid
                      description: ID of administering staff
                    scheduled_amount:
                      type: number
                      minimum: 0
                    administered_amount:
                      type: number
                      minimum: 0
                      description: Actual amount given
                    unit:
                      type: string
                      maxLength: 20
                    method:
                      type: string
                      description: Administration method
                    witnessed_by:
                      type: string
                      format: uuid
                      description: Witness for controlled substances
                    vitals_before:
                      type: object
                      properties:
                        blood_pressure_systolic:
                          type: integer
                          minimum: 40
                          maximum: 300
                        blood_pressure_diastolic:
                          type: integer
                          minimum: 20
                          maximum: 200
                        heart_rate:
                          type: integer
                          minimum: 20
                          maximum: 300
                        temperature_fahrenheit:
                          type: number
                          minimum: 85
                          maximum: 115
                        respiratory_rate:
                          type: integer
                          minimum: 5
                          maximum: 60
                        oxygen_saturation:
                          type: integer
                          minimum: 50
                          maximum: 100
                        pain_scale:
                          type: integer
                          minimum: 0
                          maximum: 10
                    vitals_after:
                      type: object
                      properties:
                        blood_pressure_systolic:
                          type: integer
                          minimum: 40
                          maximum: 300
                        blood_pressure_diastolic:
                          type: integer
                          minimum: 20
                          maximum: 200
                        heart_rate:
                          type: integer
                          minimum: 20
                          maximum: 300
                        temperature_fahrenheit:
                          type: number
                          minimum: 85
                          maximum: 115
                        respiratory_rate:
                          type: integer
                          minimum: 5
                          maximum: 60
                        oxygen_saturation:
                          type: integer
                          minimum: 50
                          maximum: 100
                        pain_scale:
                          type: integer
                          minimum: 0
                          maximum: 10
                    side_effects:
                      type: array
                      items:
                        type: string
                        maxLength: 200
                    notes:
                      type: string
                      maxLength: 1000
                event_metadata:
                  allOf:
                    - type: object
                      required:
                        - user_id
                        - reason
                      properties:
                        user_id:
                          type: string
                          format: uuid
                          description: ID of the user who initiated this event
                        reason:
                          type: string
                          minLength: 10
                          maxLength: 500
                          description: >
                            Business justification for this action. This field
                            captures the "WHY"

                            behind every change and is REQUIRED for all events.
                          examples:
                            - >-
                              Patient showed allergic reaction to previous
                              medication
                            - >-
                              Dosage adjustment per physician consultation on
                              2024-01-15
                            - >-
                              Regular intake from emergency department referral
                              #12345
                        user_email:
                          type: string
                          format: email
                          description: Email of the user who initiated this event
                        user_name:
                          type: string
                          description: Name of the user who initiated this event
                        correlation_id:
                          type: string
                          format: uuid
                          description: ID to correlate related events across the system
                        causation_id:
                          type: string
                          format: uuid
                          description: ID of the event that caused this event
                        ip_address:
                          type: string
                          format: ipv4
                          description: IP address of the client
                        user_agent:
                          type: string
                          description: User agent string of the client
                        approval_chain:
                          type: array
                          description: Chain of approvals for this action
                          items:
                            type: object
                            required:
                              - approver_id
                              - approved_at
                              - role
                            properties:
                              approver_id:
                                type: string
                                format: uuid
                                description: ID of the approver
                              approver_name:
                                type: string
                                description: Name of the approver
                              approver_email:
                                type: string
                                format: email
                              approved_at:
                                type: string
                                format: date-time
                                description: When approval was granted
                              role:
                                type: string
                                enum:
                                  - physician
                                  - nurse_practitioner
                                  - pharmacist
                                  - administrator
                                  - supervisor
                                description: Role of the approver
                              notes:
                                type: string
                                description: Approval notes or conditions
                        notes:
                          type: string
                          maxLength: 2000
                          description: Additional context or notes
                    - type: object
                      required:
                        - reason
                      properties:
                        reason:
                          examples:
                            - >-
                              Scheduled morning medication administered with
                              breakfast
                            - PRN medication given for reported pain level 7/10
                            - >-
                              Emergency medication administered for acute
                              anxiety episode
          - name: medication.skipped
            title: Medication Skipped
            summary: A scheduled medication dose was skipped
            contentType: application/json
            payload:
              type: object
              required:
                - stream_id
                - stream_type
                - event_type
                - event_data
                - event_metadata
              properties:
                stream_id:
                  type: string
                  format: uuid
                stream_type:
                  type: string
                  const: dosage
                event_type:
                  type: string
                  const: medication.skipped
                event_data:
                  type: object
                  required:
                    - organization_id
                    - client_id
                    - medication_history_id
                    - scheduled_datetime
                    - skip_reason
                  properties:
                    organization_id:
                      type: string
                      format: uuid
                    client_id:
                      type: string
                      format: uuid
                    medication_history_id:
                      type: string
                      format: uuid
                    scheduled_datetime:
                      type: string
                      format: date-time
                    scheduled_amount:
                      type: number
                    unit:
                      type: string
                    skip_reason:
                      type: string
                      enum:
                        - client_absent
                        - client_npo
                        - medication_unavailable
                        - clinical_hold
                        - physician_order
                        - vital_signs_out_of_range
                        - other
                    skip_details:
                      type: string
                      maxLength: 500
                event_metadata:
                  allOf:
                    - type: object
                      required:
                        - user_id
                        - reason
                      properties:
                        user_id:
                          type: string
                          format: uuid
                          description: ID of the user who initiated this event
                        reason:
                          type: string
                          minLength: 10
                          maxLength: 500
                          description: >
                            Business justification for this action. This field
                            captures the "WHY"

                            behind every change and is REQUIRED for all events.
                          examples:
                            - >-
                              Patient showed allergic reaction to previous
                              medication
                            - >-
                              Dosage adjustment per physician consultation on
                              2024-01-15
                            - >-
                              Regular intake from emergency department referral
                              #12345
                        user_email:
                          type: string
                          format: email
                          description: Email of the user who initiated this event
                        user_name:
                          type: string
                          description: Name of the user who initiated this event
                        correlation_id:
                          type: string
                          format: uuid
                          description: ID to correlate related events across the system
                        causation_id:
                          type: string
                          format: uuid
                          description: ID of the event that caused this event
                        ip_address:
                          type: string
                          format: ipv4
                          description: IP address of the client
                        user_agent:
                          type: string
                          description: User agent string of the client
                        approval_chain:
                          type: array
                          description: Chain of approvals for this action
                          items:
                            type: object
                            required:
                              - approver_id
                              - approved_at
                              - role
                            properties:
                              approver_id:
                                type: string
                                format: uuid
                                description: ID of the approver
                              approver_name:
                                type: string
                                description: Name of the approver
                              approver_email:
                                type: string
                                format: email
                              approved_at:
                                type: string
                                format: date-time
                                description: When approval was granted
                              role:
                                type: string
                                enum:
                                  - physician
                                  - nurse_practitioner
                                  - pharmacist
                                  - administrator
                                  - supervisor
                                description: Role of the approver
                              notes:
                                type: string
                                description: Approval notes or conditions
                        notes:
                          type: string
                          maxLength: 2000
                          description: Additional context or notes
                    - type: object
                      required:
                        - reason
                      properties:
                        reason:
                          examples:
                            - Client was NPO for scheduled procedure
                            - Medication held due to low blood pressure reading
                            - Skipped per physician order due to lab results
          - name: medication.refused
            title: Medication Refused
            summary: A client refused a medication dose
            contentType: application/json
            payload:
              type: object
              required:
                - stream_id
                - stream_type
                - event_type
                - event_data
                - event_metadata
              properties:
                stream_id:
                  type: string
                  format: uuid
                stream_type:
                  type: string
                  const: dosage
                event_type:
                  type: string
                  const: medication.refused
                event_data:
                  type: object
                  required:
                    - organization_id
                    - client_id
                    - medication_history_id
                    - scheduled_datetime
                    - refusal_reason
                  properties:
                    organization_id:
                      type: string
                      format: uuid
                    client_id:
                      type: string
                      format: uuid
                    medication_history_id:
                      type: string
                      format: uuid
                    scheduled_datetime:
                      type: string
                      format: date-time
                    refusal_reason:
                      type: string
                      maxLength: 500
                    client_stated_reason:
                      type: string
                      maxLength: 500
                      description: Client's stated reason in their own words
                    education_provided:
                      type: boolean
                      description: Was education about risks provided
                    provider_notified:
                      type: boolean
                      description: Was provider notified of refusal
                    follow_up_plan:
                      type: string
                      maxLength: 1000
                event_metadata:
                  allOf:
                    - type: object
                      required:
                        - user_id
                        - reason
                      properties:
                        user_id:
                          type: string
                          format: uuid
                          description: ID of the user who initiated this event
                        reason:
                          type: string
                          minLength: 10
                          maxLength: 500
                          description: >
                            Business justification for this action. This field
                            captures the "WHY"

                            behind every change and is REQUIRED for all events.
                          examples:
                            - >-
                              Patient showed allergic reaction to previous
                              medication
                            - >-
                              Dosage adjustment per physician consultation on
                              2024-01-15
                            - >-
                              Regular intake from emergency department referral
                              #12345
                        user_email:
                          type: string
                          format: email
                          description: Email of the user who initiated this event
                        user_name:
                          type: string
                          description: Name of the user who initiated this event
                        correlation_id:
                          type: string
                          format: uuid
                          description: ID to correlate related events across the system
                        causation_id:
                          type: string
                          format: uuid
                          description: ID of the event that caused this event
                        ip_address:
                          type: string
                          format: ipv4
                          description: IP address of the client
                        user_agent:
                          type: string
                          description: User agent string of the client
                        approval_chain:
                          type: array
                          description: Chain of approvals for this action
                          items:
                            type: object
                            required:
                              - approver_id
                              - approved_at
                              - role
                            properties:
                              approver_id:
                                type: string
                                format: uuid
                                description: ID of the approver
                              approver_name:
                                type: string
                                description: Name of the approver
                              approver_email:
                                type: string
                                format: email
                              approved_at:
                                type: string
                                format: date-time
                                description: When approval was granted
                              role:
                                type: string
                                enum:
                                  - physician
                                  - nurse_practitioner
                                  - pharmacist
                                  - administrator
                                  - supervisor
                                description: Role of the approver
                              notes:
                                type: string
                                description: Approval notes or conditions
                        notes:
                          type: string
                          maxLength: 2000
                          description: Additional context or notes
                    - type: object
                      required:
                        - reason
                      properties:
                        reason:
                          examples:
                            - Client exercised right to refuse medication
                            - Client reported severe nausea from previous dose
                            - >-
                              Client wants to discuss with family before
                              continuing
          - name: medication.discontinued
            title: Medication Discontinued
            summary: A medication prescription has been discontinued
            contentType: application/json
            payload:
              type: object
              required:
                - stream_id
                - stream_type
                - event_type
                - event_data
                - event_metadata
              properties:
                stream_id:
                  type: string
                  format: uuid
                stream_type:
                  type: string
                  const: medication_history
                event_type:
                  type: string
                  const: medication.discontinued
                event_data:
                  type: object
                  required:
                    - medication_history_id
                    - discontinue_date
                    - discontinue_reason_category
                  properties:
                    medication_history_id:
                      type: string
                      format: uuid
                    discontinue_date:
                      type: string
                      format: date
                    discontinue_reason_category:
                      type: string
                      enum:
                        - adverse_reaction
                        - ineffective
                        - client_request
                        - treatment_complete
                        - cost
                        - drug_interaction
                        - contraindication
                        - other
                    discontinue_details:
                      type: string
                      maxLength: 2000
                    adverse_events:
                      type: array
                      items:
                        type: string
                        maxLength: 500
                    alternative_medication:
                      type: string
                      maxLength: 200
                      description: Alternative medication if switching
                    tapering_schedule:
                      type: string
                      maxLength: 1000
                      description: Tapering instructions if applicable
                event_metadata:
                  allOf:
                    - type: object
                      required:
                        - user_id
                        - reason
                      properties:
                        user_id:
                          type: string
                          format: uuid
                          description: ID of the user who initiated this event
                        reason:
                          type: string
                          minLength: 10
                          maxLength: 500
                          description: >
                            Business justification for this action. This field
                            captures the "WHY"

                            behind every change and is REQUIRED for all events.
                          examples:
                            - >-
                              Patient showed allergic reaction to previous
                              medication
                            - >-
                              Dosage adjustment per physician consultation on
                              2024-01-15
                            - >-
                              Regular intake from emergency department referral
                              #12345
                        user_email:
                          type: string
                          format: email
                          description: Email of the user who initiated this event
                        user_name:
                          type: string
                          description: Name of the user who initiated this event
                        correlation_id:
                          type: string
                          format: uuid
                          description: ID to correlate related events across the system
                        causation_id:
                          type: string
                          format: uuid
                          description: ID of the event that caused this event
                        ip_address:
                          type: string
                          format: ipv4
                          description: IP address of the client
                        user_agent:
                          type: string
                          description: User agent string of the client
                        approval_chain:
                          type: array
                          description: Chain of approvals for this action
                          items:
                            type: object
                            required:
                              - approver_id
                              - approved_at
                              - role
                            properties:
                              approver_id:
                                type: string
                                format: uuid
                                description: ID of the approver
                              approver_name:
                                type: string
                                description: Name of the approver
                              approver_email:
                                type: string
                                format: email
                              approved_at:
                                type: string
                                format: date-time
                                description: When approval was granted
                              role:
                                type: string
                                enum:
                                  - physician
                                  - nurse_practitioner
                                  - pharmacist
                                  - administrator
                                  - supervisor
                                description: Role of the approver
                              notes:
                                type: string
                                description: Approval notes or conditions
                        notes:
                          type: string
                          maxLength: 2000
                          description: Additional context or notes
                    - type: object
                      required:
                        - reason
                      properties:
                        reason:
                          examples:
                            - >-
                              Discontinued due to severe allergic reaction
                              requiring emergency intervention
                            - >-
                              Treatment completed successfully, medication no
                              longer needed
                            - >-
                              Switching to alternative medication for better
                              efficacy
                            - >-
                              Discontinued per client request after informed
                              consent discussion
          - name: user.synced_from_zitadel
            title: User Synced from Zitadel
            summary: User information synchronized from Zitadel identity provider
            contentType: application/json
            payload:
              type: object
              required:
                - stream_id
                - stream_type
                - event_type
                - event_data
                - event_metadata
              properties:
                stream_id:
                  type: string
                  format: uuid
                stream_type:
                  type: string
                  const: user
                event_type:
                  type: string
                  const: user.synced_from_zitadel
                event_data:
                  type: object
                  required:
                    - external_id
                    - email
                    - roles
                  properties:
                    external_id:
                      type: string
                      description: Zitadel User ID
                    email:
                      type: string
                      format: email
                    name:
                      type: string
                    roles:
                      type: array
                      items:
                        type: string
                        enum:
                          - super_admin
                          - administrator
                          - clinician
                          - specialist
                          - parent
                          - youth
                    accessible_organizations:
                      type: array
                      items:
                        type: string
                        format: uuid
                event_metadata:
                  allOf:
                    - type: object
                      required:
                        - user_id
                        - reason
                      properties:
                        user_id:
                          type: string
                          format: uuid
                          description: ID of the user who initiated this event
                        reason:
                          type: string
                          minLength: 10
                          maxLength: 500
                          description: >
                            Business justification for this action. This field
                            captures the "WHY"

                            behind every change and is REQUIRED for all events.
                          examples:
                            - >-
                              Patient showed allergic reaction to previous
                              medication
                            - >-
                              Dosage adjustment per physician consultation on
                              2024-01-15
                            - >-
                              Regular intake from emergency department referral
                              #12345
                        user_email:
                          type: string
                          format: email
                          description: Email of the user who initiated this event
                        user_name:
                          type: string
                          description: Name of the user who initiated this event
                        correlation_id:
                          type: string
                          format: uuid
                          description: ID to correlate related events across the system
                        causation_id:
                          type: string
                          format: uuid
                          description: ID of the event that caused this event
                        ip_address:
                          type: string
                          format: ipv4
                          description: IP address of the client
                        user_agent:
                          type: string
                          description: User agent string of the client
                        approval_chain:
                          type: array
                          description: Chain of approvals for this action
                          items:
                            type: object
                            required:
                              - approver_id
                              - approved_at
                              - role
                            properties:
                              approver_id:
                                type: string
                                format: uuid
                                description: ID of the approver
                              approver_name:
                                type: string
                                description: Name of the approver
                              approver_email:
                                type: string
                                format: email
                              approved_at:
                                type: string
                                format: date-time
                                description: When approval was granted
                              role:
                                type: string
                                enum:
                                  - physician
                                  - nurse_practitioner
                                  - pharmacist
                                  - administrator
                                  - supervisor
                                description: Role of the approver
                              notes:
                                type: string
                                description: Approval notes or conditions
                        notes:
                          type: string
                          maxLength: 2000
                          description: Additional context or notes
                    - properties:
                        reason:
                          examples:
                            - Initial user sync after Zitadel registration
                            - Role update sync after admin promotion
                            - Periodic sync to ensure consistency
          - name: user.organization_switched
            title: User Organization Switched
            summary: User switched their active organization context
            contentType: application/json
            payload:
              type: object
              required:
                - stream_id
                - stream_type
                - event_type
                - event_data
                - event_metadata
              properties:
                stream_id:
                  type: string
                  format: uuid
                stream_type:
                  type: string
                  const: user
                event_type:
                  type: string
                  const: user.organization_switched
                event_data:
                  type: object
                  required:
                    - user_id
                    - from_organization_id
                    - to_organization_id
                  properties:
                    user_id:
                      type: string
                      format: uuid
                    from_organization_id:
                      type: string
                      format: uuid
                      nullable: true
                    to_organization_id:
                      type: string
                      format: uuid
                event_metadata:
                  allOf:
                    - type: object
                      required:
                        - user_id
                        - reason
                      properties:
                        user_id:
                          type: string
                          format: uuid
                          description: ID of the user who initiated this event
                        reason:
                          type: string
                          minLength: 10
                          maxLength: 500
                          description: >
                            Business justification for this action. This field
                            captures the "WHY"

                            behind every change and is REQUIRED for all events.
                          examples:
                            - >-
                              Patient showed allergic reaction to previous
                              medication
                            - >-
                              Dosage adjustment per physician consultation on
                              2024-01-15
                            - >-
                              Regular intake from emergency department referral
                              #12345
                        user_email:
                          type: string
                          format: email
                          description: Email of the user who initiated this event
                        user_name:
                          type: string
                          description: Name of the user who initiated this event
                        correlation_id:
                          type: string
                          format: uuid
                          description: ID to correlate related events across the system
                        causation_id:
                          type: string
                          format: uuid
                          description: ID of the event that caused this event
                        ip_address:
                          type: string
                          format: ipv4
                          description: IP address of the client
                        user_agent:
                          type: string
                          description: User agent string of the client
                        approval_chain:
                          type: array
                          description: Chain of approvals for this action
                          items:
                            type: object
                            required:
                              - approver_id
                              - approved_at
                              - role
                            properties:
                              approver_id:
                                type: string
                                format: uuid
                                description: ID of the approver
                              approver_name:
                                type: string
                                description: Name of the approver
                              approver_email:
                                type: string
                                format: email
                              approved_at:
                                type: string
                                format: date-time
                                description: When approval was granted
                              role:
                                type: string
                                enum:
                                  - physician
                                  - nurse_practitioner
                                  - pharmacist
                                  - administrator
                                  - supervisor
                                description: Role of the approver
                              notes:
                                type: string
                                description: Approval notes or conditions
                        notes:
                          type: string
                          maxLength: 2000
                          description: Additional context or notes
                    - properties:
                        reason:
                          examples:
                            - User selected different organization from dropdown
                            - Automatic switch after single org access granted
                            - Session initialization with default organization
components:
  schemas:
    DomainEvent:
      type: object
      required:
        - id
        - stream_id
        - stream_type
        - stream_version
        - event_type
        - event_data
        - event_metadata
        - created_at
      properties:
        id:
          type: string
          format: uuid
          description: Unique event identifier
        stream_id:
          type: string
          format: uuid
          description: The entity/aggregate this event belongs to
        stream_type:
          type: string
          enum:
            - client
            - medication
            - medication_history
            - dosage
            - user
            - organization
          description: Type of entity this event affects
        stream_version:
          type: integer
          minimum: 1
          description: Version number within this stream
        event_type:
          type: string
          pattern: ^[a-z_]+\.[a-z_]+$
          description: Event type in format domain.action
          examples:
            - client.registered
            - medication.prescribed
        event_data:
          type: object
          description: The actual event payload
        event_metadata:
          type: object
          required:
            - user_id
            - reason
          properties:
            user_id:
              type: string
              format: uuid
              description: ID of the user who initiated this event
            reason:
              type: string
              minLength: 10
              maxLength: 500
              description: >
                Business justification for this action. This field captures the
                "WHY"

                behind every change and is REQUIRED for all events.
              examples:
                - Patient showed allergic reaction to previous medication
                - Dosage adjustment per physician consultation on 2024-01-15
                - 'Regular intake from emergency department referral #12345'
            user_email:
              type: string
              format: email
              description: Email of the user who initiated this event
            user_name:
              type: string
              description: Name of the user who initiated this event
            correlation_id:
              type: string
              format: uuid
              description: ID to correlate related events across the system
            causation_id:
              type: string
              format: uuid
              description: ID of the event that caused this event
            ip_address:
              type: string
              format: ipv4
              description: IP address of the client
            user_agent:
              type: string
              description: User agent string of the client
            approval_chain:
              type: array
              description: Chain of approvals for this action
              items:
                type: object
                required:
                  - approver_id
                  - approved_at
                  - role
                properties:
                  approver_id:
                    type: string
                    format: uuid
                    description: ID of the approver
                  approver_name:
                    type: string
                    description: Name of the approver
                  approver_email:
                    type: string
                    format: email
                  approved_at:
                    type: string
                    format: date-time
                    description: When approval was granted
                  role:
                    type: string
                    enum:
                      - physician
                      - nurse_practitioner
                      - pharmacist
                      - administrator
                      - supervisor
                    description: Role of the approver
                  notes:
                    type: string
                    description: Approval notes or conditions
            notes:
              type: string
              maxLength: 2000
              description: Additional context or notes
        created_at:
          type: string
          format: date-time
          description: When the event was created
        processed_at:
          type: string
          format: date-time
          description: When the event was successfully processed
          nullable: true
        processing_error:
          type: string
          description: Error message if processing failed
          nullable: true
